h1. Настройка пула подключений к базе данных

Соединения с базой данных Active Record управляются с помощью +ActiveRecord::ConnectionAdapters::ConnectionPool+, который обеспечивает, что пул подключений синхронизирует количество тредов, получающих доступ, с ограниченным количеством подключений к базе данных. Этот лимит по умолчанию 5, и может быть настроен в +database.yml+.

<ruby>
development:
  adapter: sqlite3
  database: db/development.sqlite3
  pool: 5
  timeout: 5000
</ruby>

Поскольку управление пулом подключений по умолчанию происходит внутри ActiveRecord, все серверы приложения (Thin, mongrel, Unicorn и т.д.) должны вести себя так же. В самом начале пул подключений к базе данных пуст, и он будет создавать дополнительные подключения по мере роста запросов на них, пока не достигнет ограничения на подключения.

Каждый новый запрос займет подключение, как только он впервые запросит доступ в базу данных, после этого он освободит подключение в конце, это означает, что дополнительный слот подключения будет снова доступен для следующего запроса в очереди.

NOTE. При включенном режиме +Rails.threadsafe!+ есть вероятность, что несколько тредов могут получить доступ к нескольким подключениям одновременно. Поэтому, в зависимости от текущей загрузки, вы можете легко получить несколько тредов, претендующих на ограниченное количество подключений.
