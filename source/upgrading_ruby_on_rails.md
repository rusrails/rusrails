–ê–ø–≥—Ä–µ–π–¥ Ruby on Rails
=====================

–í —ç—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å, —á—Ç–æ–±—ã –∞–ø–≥—Ä–µ–π–¥–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é Ruby on Rails. –≠—Ç–∏ —à–∞–≥–∏ —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞—Ö –ø–æ —Ä–µ–ª–∏–∑–∞–º.

–û–±—â–∏–π —Å–æ–≤–µ—Ç
-----------

–ü–µ—Ä–µ–¥ –ø–æ–ø—ã—Ç–∫–æ–π –∞–ø–≥—Ä–µ–π–¥–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–ª–µ–¥—É–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∏—á–∏–Ω–∞ –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞. –ù—É–∂–Ω–æ —Å–æ–±–ª—é—Å—Ç–∏ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏: –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é –≤ –Ω–æ–≤—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –ø–æ–∏—Å–∫–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –≤–∞—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–∞–≤—ã–∫–æ–≤ - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –º–Ω–æ–≥–∏—Ö.

### –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

–õ—É—á—à–∏–º —Å–ø–æ—Å–æ–±–æ–º —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –∞–ø–≥—Ä–µ–π–¥–∞, —ç—Ç–æ –∏–º–µ—Ç—å —Ö–æ—Ä–æ—à–µ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–æ –Ω–∞—á–∞–ª–∞ –∞–ø–≥—Ä–µ–π–¥–∞. –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏—Ö –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è, –ø—Ä–æ–≤–µ—Ä—è—è –≤—Å–µ —á–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å. –í —Å–ª—É—á–∞–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Rails —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫—É—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª–µ–π—Ç–µ —Å–µ–±—è –∏ —É–±–µ–¥–∏—Ç–µ—Å—å –≤ —Ö–æ—Ä–æ—à–µ–º —Ç–µ—Å—Ç–æ–≤–æ–º –ø–æ–∫—Ä—ã—Ç–∏–∏ _–¥–æ_ –Ω–∞—á–∞–ª–∞ –∞–ø–≥—Ä–µ–π–¥–∞.

### –í–µ—Ä—Å–∏–∏ Ruby

–í –æ—Å–Ω–æ–≤–Ω–æ–º Rails –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø—É—â–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Ruby:

* Rails 7.2 —Ç—Ä–µ–±—É–µ—Ç Ruby 3.1.0 –∏–ª–∏ –Ω–æ–≤–µ–µ.
* Rails 7.0 –∏ 7.1 —Ç—Ä–µ–±—É—é—Ç Ruby 2.7.0 –∏–ª–∏ –Ω–æ–≤–µ–µ.
* Rails 6 —Ç—Ä–µ–±—É–µ—Ç Ruby 2.5.0 –∏–ª–∏ –Ω–æ–≤–µ–µ.
* Rails 5 —Ç—Ä–µ–±—É–µ—Ç Ruby 2.2.2 –∏–ª–∏ –Ω–æ–≤–µ–µ.

–•–æ—Ä–æ—à–µ–π –∏–¥–µ–µ–π –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å Ruby –∏ Rails —Ä–∞–∑–¥–µ–ª—å–Ω–æ. –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–∏—Ç–µ—Å—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π Ruby, –∞ –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è–π—Ç–µ Rails.

### –ü—Ä–æ—Ü–µ—Å—Å –∞–ø–≥—Ä–µ–π–¥–∞

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–π Rails –ª—É—á—à–µ –¥–≤–∏–≥–∞—Ç—å—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ, –æ–¥–Ω–∞ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞ —Ä–∞–∑, —á—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏. –í–µ—Ä—Å–∏–∏ Rails –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–µ Major.Minor.Patch. –í –≥–ª–∞–≤–Ω–æ–π (Major) –∏ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π (Minor) –≤–µ—Ä—Å–∏—è—Ö –¥–æ–ø—É—Å—Ç–∏–º–æ –¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º API, –∏ —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –í–µ—Ä—Å–∏–∏ Patch –≤–∫–ª—é—á–∞—é—Ç —Ç–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç –ø—É–±–ª–∏—á–Ω–æ–µ API.

–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º:

1. –ü–∏—à–µ—Ç–µ —Ç–µ—Å—Ç—ã –∏ —É–±–µ–∂–¥–∞–µ—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç.
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –ø–∞—Ç—á–∞, —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Å–ª–µ –≤–∞—à–µ–π —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏.
3. –ß–∏–Ω–∏—Ç–µ —Ç–µ—Å—Ç—ã –∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏.
4. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –ø–∞—Ç—á–∞ —Å–ª–µ–¥—É—é—â–µ–π –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å, –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ä—Å–∏–∏ Rails.

#### –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–µ—Ä—Å–∏–∏:

1. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏ Rails –≤ `Gemfile` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `bundle update`.
2. –ò–∑–º–µ–Ω–∏—Ç–µ –≤–µ—Ä—Å–∏–∏ –¥–ª—è –ø–∞–∫–µ—Ç–æ–≤ Rails JavaScript –≤ `package.json` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `bin/rails javascript:install`, –µ—Å–ª–∏ –≤—ã –Ω–∞ jsbundling-rails.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ [–∑–∞–¥–∞—á—É Update](#the-update-task).
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ–∏ —Ç–µ—Å—Ç—ã.

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤—ã–ø—É—â–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π Rails –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ [—Ç—É—Ç](https://rubygems.org/gems/rails/versions).

### (the-update-task) –ó–∞–¥–∞—á–∞ Update

Rails –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `rails app:update`. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ Rails –≤ `Gemfile`, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –û–Ω–∞ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏.

```bash
$ bin/rails app:update
       exist  config
    conflict  config/application.rb
Overwrite /myapp/config/application.rb? (enter "h" for help) [Ynaqdh]
       force  config/application.rb
      create  config/initializers/new_framework_defaults_7_2.rb
...
```

–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –Ω–µ–æ–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–º–æ–ª—á–∞–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞

–í–æ–∑–º–æ–∂–Ω–æ, —á—Ç–æ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è Rails –±—É–¥–µ—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —á–µ–º –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏. –û–¥–Ω–∞–∫–æ, –ø–æ—Å–ª–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —à–∞–≥–∞–º, –æ–ø–∏—Å–∞–Ω–Ω—ã–º –Ω–∏–∂–µ, –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å–µ –µ—â–µ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ *–ø—Ä–µ–¥—ã–¥—É—â–µ–π* –≤–µ—Ä—Å–∏–∏ Rails. –≠—Ç–æ —Ç–∞–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è `config.load_defaults` –≤ `config/application.rb` –Ω–µ –±—ã–ª–∏ –ø–æ–∫–∞ –∏–∑–º–µ–Ω–µ–Ω—ã.

–ß—Ç–æ–±—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –¥–æ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º, –∑–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–ª–∞ —Ñ–∞–π–ª `config/initializers/new_framework_defaults_X.Y.rb` (—Å –∂–µ–ª–∞–µ–º–æ–π –≤–µ—Ä—Å–∏–µ–π Rails –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞). –°–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å–Ω–∏–º–∞—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –Ω–∏—Ö –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ; —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º —Å –Ω–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —ç—Ç–æ—Ç —Ñ–∞–π–ª –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `config.load_defaults`.

(Upgrading from Rails 7.1 to Rails 7.2) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 7.1 –Ω–∞ Rails 7.2
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 7.2 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/7_2_release_notes).

(Upgrading from Rails 7.0 to Rails 7.1) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 7.0 –Ω–∞ Rails 7.1
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 7.1 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/7_1_release_notes).

### –ü—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –≤ $LOAD_PATH

–ù–∞—á–∏–Ω–∞—è —Å Rails 7.1, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫–∞–º–∏, –±–æ–ª—å—à–µ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ `$LOAD_PATH`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏—Ö —Ñ–∞–π–ª—ã –±–æ–ª—å—à–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä—É—á–Ω—É—é —Å –ø–æ–º–æ—â—å—é –≤—ã–∑–æ–≤–∞ `require`, —á—Ç–æ, –≤–ø—Ä–æ—á–µ–º, –∏ –Ω–µ —Å–ª–µ–¥–æ–≤–∞–ª–æ –¥–µ–ª–∞—Ç—å.

–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ `$LOAD_PATH` —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–∑–æ–≤—ã `require` –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö `bootsnap`, –∏ —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ `bootsnap` –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –∂–µ–ª–∞–µ—Ç–µ –∏–º–µ—Ç—å —ç—Ç–∏ –ø—É—Ç–∏ –≤ `$LOAD_PATH`, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å:

```ruby
config.add_autoload_paths_to_load_path = true
```

–Ω–æ –º—ã –Ω–µ –æ–¥–æ–±—Ä—è–µ–º —Ç–∞–∫ –¥–µ–ª–∞—Ç—å, –∫–ª–∞—Å—Å—ã –∏ –º–æ–¥—É–ª–∏ –≤ –ø—É—Ç—è—Ö –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—Ç—Å—è –±—ã—Ç—å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –≤—Å–µ–≥–æ –ª–∏—à—å –Ω–∞ –Ω–∏—Ö —Å–æ—Å–ª–∞—Ç—å—Å—è.

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `lib` –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç—Å—è —ç—Ç–∏–º —Ñ–ª–∞–∂–∫–æ–º, –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `$LOAD_PATH`.

### config.autoload_lib –∏ config.autoload_lib_once

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ `lib` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—É—Ç—è—Ö –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏, –º–æ–∂–µ—Ç–µ –æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª. –≠—Ç–æ –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–≤ –≤—ã–≤–æ–¥

```bash
# –ü–µ—á–∞—Ç–∞–µ—Ç –ø—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏.
$ bin/rails runner 'pp Rails.autoloaders.main.dirs'

# –ü–µ—á–∞—Ç–∞–µ—Ç –ø—É—Ç–∏ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏.
$ bin/rails runner 'pp Rails.autoloaders.once.dirs'
```

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ `lib` –≤ –ø—É—Ç—è—Ö –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏, –æ–±—ã—á–Ω–æ –≤ `config/application.rb` –µ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≥–ª—è–¥–∏—Ç –Ω–∞–ø–æ–¥–æ–±–∏–µ

```ruby
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å lib, –Ω–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ (–≤–æ–∑–º–æ–∂–Ω–æ, —á—Ç–æ –∑–∞–±—ã–ª–∏).
config.autoload_paths << config.root.join("lib")
```

–∏–ª–∏

```ruby
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ —Ç–∞–∫–∂–µ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å lib.
config.autoload_paths << config.root.join("lib")
config.eager_load_paths << config.root.join("lib")
```

–∏–ª–∏

```ruby
# –¢–æ –∂–µ —Å–∞–º–æ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—Å–µ –ø—É—Ç–∏ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–∫–∂–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—É—Ç—è–º–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏.
config.eager_load_paths << config.root.join("lib")
```

–≠—Ç–æ –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∏—Ç—å —ç—Ç–∏ —Å—Ç—Ä–æ—á–∫–∏ –±–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–º

```ruby
config.autoload_lib(ignore: %w(assets tasks))
```

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ –∫ —Å–ø–∏—Å–∫—É `ignore` –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `lib`, –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Ñ–∞–π–ª—ã `.rb`, –∏–ª–∏ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å `lib/templates`, `lib/generators` –∏–ª–∏ `lib/middleware`, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –∏–º—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ `lib`:

```ruby
config.autoload_lib(ignore: %w(assets tasks templates generators middleware))
```

–° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–∏ –∫–æ–¥ (–Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–π) –≤ `lib` —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –µ—Å–ª–∏ `config.eager_load` `true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ä–µ–∂–∏–º–µ `production`). –û–±—ã—á–Ω–æ —ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –Ω–æ –µ—Å–ª–∏ `lib` –Ω–µ –¥–æ–±–∞–≤–ª—è–ª—Å—è —Ä–∞–Ω–µ–µ –≤ –ø—É—Ç–∏ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –∏ –≤—ã –≤—Å–µ –µ—â–µ –∂–µ–ª–∞–µ—Ç–µ, —á—Ç–æ–±—ã —Ç–∞–∫ –∏ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å, –≤—ã–∫–ª—é—á–∏—Ç–µ:

```ruby
Rails.autoloaders.main.do_not_eager_load(config.root.join("lib"))
```

–ú–µ—Ç–æ–¥ `config.autoload_lib_once` –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω —Ç–æ–º—É, –µ—Å–ª–∏ –±—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ `lib` –±—ã–ª –≤ `config.autoload_once_paths`.

### `ActiveStorage::BaseController` –±–æ–ª—å—à–µ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—ã–π –º–æ–¥—É–ª—å

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–µ –æ—Ç `ActiveStorage::BaseController`, –∏ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–≥–∏–∫–∏ –æ—Ç–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤, —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω—ã —è–≤–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –º–æ–¥—É–ª—å `ActiveStorage::Streaming`.

### `MemCacheStore` –∏ `RedisCacheStore` —Ç–µ–ø–µ—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

–ì–µ–º `connection_pool` –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≥–µ–º–∞ `activesupport`, –∏ `MemCacheStore` –∏ `RedisCacheStore` —Ç–µ–ø–µ—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

–ï—Å–ª–∏ –Ω–µ –∂–µ–ª–∞–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–ø—Ü–∏–∏ `:pool` `false` –ø—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫—ç—à–∞:

```ruby
config.cache_store = :mem_cache_store, "cache.example.com", { pool: false }
```

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ [–ø–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é —Å Rails](/caching-with-rails#connection-pool-options).

### `SQLite3Adapter` —Ç–µ–ø–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º–µ —Å—Ç—Ä–æ–≥–∏—Ö —Å—Ç—Ä–æ–∫

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Å—Ç—Ä–æ–≥–∏—Ö —Å—Ç—Ä–æ–∫ –æ—Ç–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã —Å –¥–≤–æ–π–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏.

–í SQLite –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏—á—É–¥, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –ª–∏—Ç–µ—Ä–∞–ª–∞–º–∏ —Å –¥–≤–æ–π–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏. –°–Ω–∞—á–∞–ª–∞ –æ–Ω –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å –¥–≤–æ–π–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –Ω–æ, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –æ–Ω —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∏—Ö –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –æ–ø–µ—á–∞—Ç–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–∑–∞–º–µ—á–µ–Ω—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å—Ç–æ–ª–±—Ü–∞. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ SQLite](https://www.sqlite.org/quirks.html#double_quoted_string_literals_are_accepted).

–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SQLite3Adapter` –≤ —Å—Ç—Ä–æ–≥–æ–º —Ä–µ–∂–∏–º–µ, —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å:

```ruby
# config/application.rb
config.active_record.sqlite3_adapter_strict_strings_by_default = false
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—É—Ç–µ–π –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è `ActionMailer::Preview`

–û–ø—Ü–∏—è `config.action_mailer.preview_path` —É—Å—Ç–∞—Ä–µ–ª–∞ –≤ –ø–æ–ª—å–∑—É `config.action_mailer.preview_paths`. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫ —ç—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ –≤—ã–∑–æ–≤–µ—Ç, —á—Ç–æ —ç—Ç–∏ –ø—É—Ç–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –ø–æ–∏—Å–∫–µ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–∏—Å–µ–º.

```ruby
config.action_mailer.preview_paths << "#{Rails.root}/lib/mailer_previews"
```

### `config.i18n.raise_on_missing_translations = true` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –¥–ª—è –ª—é–±–æ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞.

–†–∞–Ω—å—à–µ –æ–Ω –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –≤–æ –≤—å—é –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ. –¢–µ–ø–µ—Ä—å –æ–Ω –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤ `I18n.t` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π –∫–ª—é—á.

```ruby
# —Å config.i18n.raise_on_missing_translations = true

# –≤–æ –≤—å—é –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
t("missing.key") # –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.0, –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.1
I18n.t("missing.key") # –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.0, –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.1

# –≥–¥–µ —É–≥–æ–¥–Ω–æ:
I18n.t("missing.key") # –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.0, –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.1
```

–ï—Å–ª–∏ –Ω–µ –∂–µ–ª–∞–µ—Ç–µ —Ç–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `config.i18n.raise_on_missing_translations = false`:

```ruby
# —Å config.i18n.raise_on_missing_translations = false

# –≤–æ –≤—å—é –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
t("missing.key") # –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.0, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.1
I18n.t("missing.key") # –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.0, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.1

# –≥–¥–µ —É–≥–æ–¥–Ω–æ:
I18n.t("missing.key") # –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.0, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ 7.1
```

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `I18n.exception_handler`. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ i18n](/i18n#using-different-exception-handlers).

`AbstractController::Translation.raise_on_missing_translations` –±—ã–ª —É–±—Ä–∞–Ω. –≠—Ç–æ –±—ã–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–π API, –µ—Å–ª–∏ –≤—ã –ø–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ –Ω–µ–≥–æ, —Å–ª–µ–¥—É–µ—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ `config.i18n.raise_on_missing_translations` –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

### `bin/rails test` —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É `test:prepare`

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é `bin/rails test` –¥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–∞ –∑–∞–¥–∞—á–∞ `rake test:prepare`. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ `test:prepare` –±—ã–ª–∞ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∞, —ç—Ç–∏ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏—è –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã –¥–æ —Ç–µ—Å—Ç–æ–≤. `tailwindcss-rails`, `jsbundling-rails` –∏ `cssbundling-rails` —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É—é—Ç —ç—Ç—É –∑–∞–¥–∞—á—É, —Ç–∞–∫–∂–µ –∫–∞–∫ –∏ –¥—Ä—É–≥–∏–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –≥–µ–º—ã.

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ Rails](/testing#running-tests-in-continuous-integration-ci).

–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Ç–µ—Å—Ç—ã –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (`bin/rails test test/models/user_test.rb`), `test:prepare` –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –ø–µ—Ä–µ–¥ —ç—Ç–∏–º.

### –ò–∑–º–µ–Ω–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ `@rails/ujs`

–ù–∞—á–∏–Ω–∞—è —Å Rails 7.1, –∏–∑–º–µ–Ω–∏–ª—Å—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π –∏–∑ `@rails/ujs`. Rails –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –∏–∑ `@rails/ujs`.

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –±—É–¥–µ—Ç –Ω–µ—É–¥–∞—á–Ω–æ–π:

```javascript
import { fileInputSelector } from "@rails/ujs"
// ERROR: export 'fileInputSelector' (imported as 'fileInputSelector') was not found in '@rails/ujs' (possible exports: default)
 ```
–í Rails 7.1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –æ–±—ä–µ–∫—Ç Rails –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ `@rails/ujs`. –ó–∞—Ç–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ Rails.

–ü—Ä–∏–º–µ—Ä –∏–º–ø–æ—Ä—Ç–∞ –≤ Rails 7.1 –ø–æ–∫–∞–∑–∞–Ω –Ω–∏–∂–µ:

```javascript
import Rails from "@rails/ujs"
// –ü—Å–µ–≤–¥–æ–Ω–∏–º –º–µ—Ç–æ–¥–∞
const fileInputSelector = Rails.fileInputSelector
// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–µ–≥–æ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ Rails, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
Rails.fileInputSelector(...)
```

### `Rails.logger` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `ActiveSupport::BroadcastLogger`

–ö–ª–∞—Å—Å `ActiveSupport::BroadcastLogger` —ç—Ç–æ –Ω–æ–≤—ã–π –ª–æ–≥–≥–µ—Ä, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø—Ä–æ—Å—Ç—ã–º –æ–±—Ä–∞–∑–æ–º —Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –≤ —Ä–∞–∑–Ω—ã–µ —Å–ª–∏–≤—ã (STDOUT, —Ñ–∞–π–ª –ª–æ–≥–∞...).

API —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –ª–æ–≥–æ–≤ (—Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `ActiveSupport::Logger.broadcast`) –±—ã–ª —É–±—Ä–∞–Ω, –∏ –±—ã–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–º —Ä–∞–Ω—å—à–µ. –ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ —ç—Ç–æ—Ç API, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```ruby
logger = Logger.new("some_file.log")

# –î–æ

Rails.logger.extend(ActiveSupport::Logger.broadcast(logger))

# –ü–æ—Å–ª–µ

Rails.logger.broadcast_to(logger)
```

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ª–æ–≥–≥–µ—Ä, `Rails.logger` –æ–±–µ—Ä–Ω–µ—Ç –∏–ª–∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã –∫ –Ω–µ–º—É. –ù–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `broadcasts`:

```ruby
# config/application.rb
config.logger = MyLogger.new

# –ì–¥–µ —É–≥–æ–¥–Ω–æ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
puts Rails.logger.class #=> BroadcastLogger
puts Rails.logger.broadcasts #=> [MyLogger]
```

[assert_match]: https://docs.seattlerb.org/minitest/Minitest/Assertions.html#method-i-assert_match

### –ò–∑–º–µ–Ω–∏–ª–∏—Å—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è Active Record

–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ Active Record —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SHA-256 –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞ —Ö—ç—à–∞. –ï—Å–ª–∏ —É –≤–∞—Å –∏–º–µ—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Rails, –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è:

1. –ï—Å–ª–∏ —É –≤–∞—Å `config.active_support.key_generator_hash_digest_class` —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ SHA-1 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ Rails 7.0), –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å SHA-1 –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è Active Record:

    ```ruby
    config.active_record.encryption.hash_digest_class = OpenSSL::Digest::SHA1
    ```

2. –ï—Å–ª–∏ —É –≤–∞—Å `config.active_support.key_generator_hash_digest_class` —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ SHA-256 (–Ω–æ–≤–æ–µ —É–º–æ–ª—á–∞–Ω–∏–µ –≤ 7.0), –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å SHA-256 –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è Active Record:

    ```ruby
    config.active_record.encryption.hash_digest_class = OpenSSL::Digest::SHA256
    ```

–°–º–æ—Ç—Ä–∏—Ç–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ [Configuring Rails Applications](/configuring#config-active-record-encryption-hash-digest-class) –æ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è—Ö –ø–æ `config.active_record.encryption.hash_digest_class`.

–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—ã–ª–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è [`config.active_record.encryption.support_sha1_for_non_deterministic_encryption`](/configuring#config-active-record-encryption-support-sha1-for-non-deterministic-encryption) —á—Ç–æ–±—ã –ø–æ—á–∏–Ω–∏—Ç—å [–±–∞–≥](https://github.com/rails/rails/issues/42922), –≤—ã–∑—ã–≤–∞—é—â–∏–π —Ç–æ, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –±—ã–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é SHA-1, –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω SHA-256 —Å –ø–æ–º–æ—â—å—é –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `hash_digest_class`.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `config.active_record.encryption.support_sha1_for_non_deterministic_encryption` –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ Rails 7.1. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –≤–µ—Ä—Å–∏–∏ Rails < 7.1, –∫–æ—Ç–æ—Ä—ã–µ, –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç—ã–º –±–∞–≥–æ–º, —ç—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞:

```ruby
config.active_record.encryption.support_sha1_for_non_deterministic_encryption = true
```

–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –≤—ã—à–µ–∏–∑–ª–æ–∂–µ–Ω–Ω–æ–µ.

### –ù–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ —Ç–µ—Å—Ç–∞—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `config.action_dispatch.show_exceptions` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –∫–∞–∫ Action Pack –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã.

–î–æ Rails 7.1 —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `config.action_dispatch.show_exceptions = true` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–ª–∞ Action Pack –ª–æ–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–∫–∏, –Ω–∞–ø–æ–¥–æ–±–∏–µ —Ä–µ–Ω–¥–µ—Ä–∞ `public/404.html` —Å–æ –∫–æ–¥–æ–º —Å—Ç–∞—Ç—É—Å–∞ `404 Not found` –≤–º–µ—Å—Ç–æ –≤—ã–∑–æ–≤–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è `ActiveRecord::RecordNotFound`. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `config.action_dispatch.show_exceptions = false` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–ª–∞ Action Pack –Ω–µ –ª–æ–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –î–æ Rails 7.1 –Ω–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å —Å–æ —Å—Ç—Ä–æ—á–∫–æ–π –≤ `config/environments/test.rb`, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–µ–π `config.action_dispatch.show_exceptions = false`.

Rails 7.1 –∏–∑–º–µ–Ω—è–µ—Ç –ø—Ä–∏–µ–º–ª–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å `true` –∏ `false` –Ω–∞ `:all`, `:rescuable` –∏ `:none`.

* `:all` - —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ `true`)
* `:rescuable` - —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–∫–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ [`config.action_dispatch.rescue_responses`](/configuring#config-action-dispatch-rescue-responses)
* `:none` (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ `false`) - –Ω–µ –ª–æ–≤–∏—Ç—å –ª—é–±—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ Rails 7.1 –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–∏–º–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç `config.action_dispatch.show_exceptions = :rescuable` –≤ –∏—Ö `config/environments/test.rb`. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `config.action_dispatch.show_exceptions = :rescuable`, —á—Ç–æ–±—ã –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–æ–≤—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º, –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–æ–≤—ã–º–∏ (`true` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `:all`, `false` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `:none`).

(Upgrading from Rails 6.1 to Rails 7.0) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 6.1 –Ω–∞ Rails 7.0
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 7.0 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/7_0_release_notes).

### –ò–∑–º–µ–Ω–∏–≤—à–µ–µ—Å—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ `ActionView::Helpers::UrlHelper#button_to`

–ù–∞—á–∏–Ω–∞—è —Å Rails 7.0 `button_to` —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Ç–µ–≥ `form` —Å –º–µ—Ç–æ–¥–æ–º HTTP `patch`, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç Active Record, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å URL –∫–Ω–æ–ø–∫–∏. –ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —è–≤–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –æ–ø—Ü–∏–∏ `method:`:

```diff
-button_to("Do a POST", [:my_custom_post_action_on_workshop, Workshop.find(1)])
+button_to("Do a POST", [:my_custom_post_action_on_workshop, Workshop.find(1)], method: :post)
```

–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö–µ–ª–ø–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è URL:

```diff
-button_to("Do a POST", [:my_custom_post_action_on_workshop, Workshop.find(1)])
+button_to("Do a POST", my_custom_post_action_on_workshop_workshop_path(Workshop.find(1)))
```

### Spring

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Spring, –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ, –∫–∞–∫ –º–∏–Ω–∏–º—É–º, –≤–µ—Ä—Å–∏–∏ 3.0.0. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ

```
undefined method `mechanism=' for ActiveSupport::Dependencies:Module
```

–ê —Ç–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ [`config.cache_classes`][] —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `false` –≤ `config/environments/test.rb`.

[`config.cache_classes`]: /configuring#config-cache-classes

### Sprockets —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å

–ì–µ–º `rails` –±–æ–ª—å—à–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `sprockets-rails`. –ï—Å–ª–∏ –≤–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –≤—Å–µ –µ—â–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Sprockets, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ `sprockets-rails` –≤ —Å–≤–æ–π Gemfile.

```ruby
gem "sprockets-rails"
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º–µ `zeitwerk`

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤—Å–µ –µ—â–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –≤ —Ä–µ–∂–∏–º–µ `classic`, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã –≤ —Ä–µ–∂–∏–º `zeitwerk`. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É [–ö–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ —Å Classic –Ω–∞ Zeitwerk](/classic-to-zeitwerk-howto).

### –ú–µ—Ç–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è `config.autoloader=` –±—ã–ª —É–¥–∞–ª–µ–Ω

–í Rails 7 –±–æ–ª—å—à–µ –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, `config.autoloader=` –±—ã–ª —É–¥–∞–ª–µ–Ω. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –±—ã–ª–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å `:zeitwerk` –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ, –ø—Ä–æ—Å—Ç–æ —É–±–µ—Ä–∏—Ç–µ –µ–µ.

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–π API `ActiveSupport::Dependencies` –±—ã–ª —É–¥–∞–ª–µ–Ω

–ü—Ä–∏–≤–∞—Ç–Ω—ã–π API `ActiveSupport::Dependencies` –±—ã–ª —É–¥–∞–ª–µ–Ω. –û–Ω –≤–∫–ª—é—á–∞–ª –º–µ—Ç–æ–¥—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ `hook!`, `unhook!`, `depend_on`, `require_or_load`, `mechanism` –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ.

–ù–µ–º–Ω–æ–≥–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤:

* –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `ActiveSupport::Dependencies.constantize` –∏–ª–∏ `ActiveSupport::Dependencies.safe_constantize`, –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç–µ –∏—Ö –Ω–∞ `String#constantize` –∏–ª–∏ `String#safe_constantize`.

  ```ruby
  ActiveSupport::Dependencies.constantize("User") # –ë–û–õ–¨–®–ï –ù–ï–í–û–ó–ú–û–ñ–ù–û
  "User".constantize # üëç
  ```

* –õ—é–±–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ActiveSupport::Dependencies.mechanism`, —á—Ç–µ–Ω–∏–µ –∏–ª–∏ –∑–∞–ø–∏—Å—å, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω–æ –¥–æ—Å—Ç—É–ø–æ–º –∫ `config.cache_classes`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

* –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞, `ActiveSupport::Dependencies.verbose=` –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –≤ `Rails.autoloaders.log!` –≤ `config/application.rb`.

–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∞—Å—Å—ã –∏–ª–∏ –º–æ–¥—É–ª–∏ —Ç–æ–∂–µ –∏—Å—á–µ–∑–ª–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ `ActiveSupport::Dependencies::Reference`, `ActiveSupport::Dependencies::Blamable` –∏ –ø—Ä–æ—á–∏–µ.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–µ –±–ª–æ–∫–æ–≤ `to_prepare`, –ø–æ–ª—É—á–∞–ª–∏ —ç—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—ã–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏, –∏ –ø–æ–ª—É—á–∞–ª–∏ —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–∞—á–∏–Ω–∞—è —Å Rails 6.0:

```
DEPRECATION WARNING: Initialization autoloaded the constant ....

Being able to do this is deprecated. Autoloading during initialization is going
to be an error condition in future versions of Rails.

...
```

–ï—Å–ª–∏ –≤—ã –≤—Å–µ –µ—â–µ –ø–æ–ª—É—á–∞–µ—Ç–µ —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É –æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ [—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –ø–æ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–µ](/autoloading-and-reloading-constants#autoloading-when-the-application-boots). –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ `NameError` –≤ Rails 7.

–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º `once` –º–æ–≥—É—Ç –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –∏ –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –±–ª–æ–∫ `to_prepare` –Ω–µ –Ω—É–∂–µ–Ω. –û–¥–Ω–∞–∫–æ, –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç—Ç–æ–≥–æ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫ `once` —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ. –ï—Å–ª–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏–º–µ—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–ª–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫ `once` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –æ –Ω–µ–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ `config/initializers/inflections.rb` –≤ —Ç–µ–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ `config/application.rb`:

```ruby
module MyApp
  class Application < Rails::Application
    # ...

    ActiveSupport::Inflector.inflections(:en) do |inflect|
      inflect.acronym "HTML"
    end
  end
end
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `config.autoload_once_paths`

–ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å [`config.autoload_once_paths`][] –≤ –∫–ª–∞—Å—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –≤ `config/application.rb`, –∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö –¥–ª—è —Å—Ä–µ–¥ –≤ `config/environments/*`.

–°—Ö–æ–∂–∏–º –æ–±—Ä–∞–∑–æ–º –≤ engine –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –≤ –∫–ª–∞—Å—Å–µ engine –∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö –¥–ª—è —Å—Ä–µ–¥.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ —ç—Ç–∏—Ö –ø—É—Ç–µ–π. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –æ—Ç—Ç—É–¥–∞ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –û–Ω–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º `Rails.autoloaders.once`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç, –∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏/–Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç.

–ï—Å–ª–∏ –≤—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —ç—Ç—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ä–µ–¥ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –∏ –ø–æ–ª—É—á–∏–ª–∏ `FrozenError`, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥.

[`config.autoload_once_paths`]: /configuring#config-autoload-once-paths

### `ActionDispatch::Request#content_type` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Content-Type –∫–∞–∫ –µ—Å—Ç—å.

–†–∞–Ω—å—à–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `ActionDispatch::Request#content_type` –ù–ï —Å–æ–¥–µ—Ä–∂–∞–ª–æ —á–∞—Å—Ç—å charset. –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ Content-Type —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∞—Å—Ç—å charset –∫–∞–∫ –µ–≥–æ —á–∞—Å—Ç—å.

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–∏–ø MIME, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ `ActionDispatch::Request#media_type`.

–î–æ:

```ruby
request = ActionDispatch::Request.new("CONTENT_TYPE" => "text/csv; header=present; charset=utf-16", "REQUEST_METHOD" => "GET")
request.content_type #=> "text/csv"
```

–ü–æ—Å–ª–µ:

```ruby
request = ActionDispatch::Request.new("Content-Type" => "text/csv; header=present; charset=utf-16", "REQUEST_METHOD" => "GET")
request.content_type #=> "text/csv; header=present; charset=utf-16"
request.media_type   #=> "text/csv"
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π —Ç—Ä–µ–±—É–µ—Ç —Ä–æ—Ç–∞—Ç–æ—Ä –∫—É–∫–∏

–ö–ª–∞—Å—Å –¥–∞–π–¥–∂–µ—Å—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –∏–∑–º–µ–Ω–∏–ª–∏ —Å SHA1 –Ω–∞ SHA256. –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ –≤ –ª—é–±—ã—Ö –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö Rails, –≤–∫–ª—é—á–∞—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É–∫–∏.

–î–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é —Å—Ç–∞—Ä–æ–≥–æ –∫–ª–∞—Å—Å–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—Ç–∞—Ç–æ—Ä. –ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å, —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–æ–º—É, —á—Ç–æ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞–Ω—É—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

–í–æ—Ç –ø—Ä–∏–º–µ—Ä —Ä–æ—Ç–∞—Ç–æ—Ä–∞ –¥–ª—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∫—É–∫–∏.

```ruby
# config/initializers/cookie_rotator.rb
Rails.application.config.after_initialize do
  Rails.application.config.action_dispatch.cookies_rotations.tap do |cookies|
    authenticated_encrypted_cookie_salt = Rails.application.config.action_dispatch.authenticated_encrypted_cookie_salt
    signed_cookie_salt = Rails.application.config.action_dispatch.signed_cookie_salt

    secret_key_base = Rails.application.secret_key_base

    key_generator = ActiveSupport::KeyGenerator.new(
      secret_key_base, iterations: 1000, hash_digest_class: OpenSSL::Digest::SHA1
    )
    key_len = ActiveSupport::MessageEncryptor.key_len

    old_encrypted_secret = key_generator.generate_key(authenticated_encrypted_cookie_salt, key_len)
    old_signed_secret = key_generator.generate_key(signed_cookie_salt)

    cookies.rotate :encrypted, old_encrypted_secret
    cookies.rotate :signed, old_signed_secret
  end
end
```

### –ö–ª–∞—Å—Å –¥–∞–π–¥–∂–µ—Å—Ç–∞ –¥–ª—è ActiveSupport::Digest –∏–∑–º–µ–Ω–∏–ª–∏ –Ω–∞ SHA256

–ö–ª–∞—Å—Å –¥–∞–π–¥–∂–µ—Å—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è ActiveSupport::Digest –∏–∑–º–µ–Ω–∏–ª–∏ —Å SHA1 –Ω–∞ SHA256. –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ –≤ —Ç–æ–º, —á—Ç–æ —Ç–∞–∫–∏–µ –≤–µ—â–∏ –∫–∞–∫ Etag –∏–ª–∏ –∫–ª—é—á–∏ —Ö—ç—à–∞, –∏–∑–º–µ–Ω—è—Ç—å—Å—è. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –∫–ª—é—á–µ–π –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Ö—ç—à—É, –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —ç—Ç–∏–º –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞ –Ω–æ–≤—ã–π —Ö—ç—à.

### –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ActiveSupport::Cache

–ë—ã–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

–ß—Ç–æ–±—ã –µ–≥–æ –≤–∫–ª—é—á–∏—Ç—å, –≤—ã –¥–æ–ª–∂–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `config.active_support.cache_format_version = 7.0`:

```ruby
# config/application.rb

config.load_defaults 6.1
config.active_support.cache_format_version = 7.0
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ:

```ruby
# config/application.rb

config.load_defaults 7.0
```

–û–¥–Ω–∞–∫–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Rails 6.1 –Ω–µ —Å–ø–æ—Å–æ–±–Ω—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ—Å—à–æ–≤–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥, –Ω—É–∂–Ω–æ —Å–ø–µ—Ä–≤–∞ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤–∞—à –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Rails 7.0 —Å `config.active_support.cache_format_version = 6.1`, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Rails –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `config.active_support.cache_format_version = 7.0`.

Rails 7.0 –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞, –ø–æ—ç—Ç–æ–º—É –Ω–µ –Ω—É–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –≤–æ –≤—Ä–µ–º—è –∞–ø–≥—Ä–µ–π–¥–∞.

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ –≤ Active Storage

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–º–µ–Ω—ã —Å—Ü–µ–Ω FFmpeg –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–æ–ª–µ–µ –∑–Ω–∞—á–∏–º—ã—Ö –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –î–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø–µ—Ä–≤—ã–π –∫–∞–¥—Ä –≤–∏–¥–µ–æ, –∏ —ç—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –ø—Ä–æ–±–ª–µ–º—ã, –µ—Å–ª–∏ –≤–∏–¥–µ–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ—è–≤–ª—è–ª–æ—Å—å –∏–∑ —á–µ—Ä–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞. –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç FFmpeg v3.4+.

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Active Storage –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ `:vips`

–î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å libvips –≤–º–µ—Å—Ç–æ ImageMagick. –≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏, —É–ª—É—á—à–∏—Ç –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –ø–æ–ª–∞–≥–∞—é—â–∏—Ö—Å—è –Ω–∞ Active Storage –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å–≤–æ–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

–û–ø—Ü–∏—è `:mini_magick` –Ω–µ —Å—Ç–∞–ª–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

–ß—Ç–æ–±—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ libvips, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```ruby
Rails.application.config.active_storage.variant_processor = :vips
```

–ó–∞—Ç–µ–º –≤–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –º–∞–∫—Ä–æ—Å `image_processing` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –æ–ø—Ü–∏–∏ ImageMagick –Ω–∞ –æ–ø—Ü–∏–∏ libvips.

#### –ó–∞–º–µ–Ω–∏—Ç–µ resize –Ω–∞ resize_to_limit

```diff
- variant(resize: "100x")
+ variant(resize_to_limit: [100, nil])
```

–ï—Å–ª–∏ –≤—ã –Ω–µ —Å–¥–µ–ª–∞–µ—Ç–µ —ç—Ç–æ, –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ vips —É–≤–∏–¥–∏—Ç–µ —ç—Ç—É –æ—à–∏–±–∫—É: `no implicit conversion to float from string`.

#### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –æ–±—Ä–µ–∑–∫–µ

```diff
- variant(crop: "1920x1080+0+0")
+ variant(crop: [0, 0, 1920, 1080])
```

–ï—Å–ª–∏ –≤—ã –Ω–µ —Å–¥–µ–ª–∞–µ—Ç–µ —ç—Ç–æ, –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ vips —É–≤–∏–¥–∏—Ç–µ —ç—Ç—É –æ—à–∏–±–∫—É: `unable to call crop: you supplied 2 arguments, but operation needs 5`.

#### –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–µ–∑–∫–∏:

Vips –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π, —á–µ–º ImageMagick, –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∫–∏:

1. –û–Ω –Ω–µ –æ–±—Ä–µ–∂–µ—Ç, –µ—Å–ª–∏ `x` –∏/–∏–ª–∏ `y` –∏–º–µ—é—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä: `[-10, -10, 100, 100]`
2. –û–Ω –Ω–µ –æ–±—Ä–µ–∂–µ—Ç, –µ—Å–ª–∏ (`x` –∏–ª–∏ `y`) –ø–ª—é—Å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å (`width`, `height`) –±–æ–ª—å—à–µ, —á–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ù–∞–ø—Ä–∏–º–µ—Ä: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 125x125 –∏ –æ–±—Ä–µ–∑–∫–∞ `[50, 50, 100, 100]`

–ï—Å–ª–∏ –≤—ã –Ω–µ —Å–¥–µ–ª–∞–µ—Ç–µ —ç—Ç–æ, –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ vips —É–≤–∏–¥–∏—Ç–µ —ç—Ç—É –æ—à–∏–±–∫—É: `extract_area: bad extract area`

#### –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ–Ω–æ–≤—ã–π —Ü–≤–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è `resize_and_pad`

Vips –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —á–µ—Ä–Ω—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ `resize_and_pad` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤–º–µ—Å—Ç–æ –±–µ–ª–æ–≥–æ –≤ ImageMagick. –ò—Å–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é –æ–ø—Ü–∏–∏ `background`:

```diff
- variant(resize_and_pad: [300, 300])
+ variant(resize_and_pad: [300, 300, background: [255]])
```

#### –£–±–µ—Ä–∏—Ç–µ –ª—é–±—ã–µ —Ä–æ—Ç–∞—Ü–∏–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ EXIF

Vips –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–æ—Ç–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –∑–Ω–∞—á–µ–Ω–∏—è EXIF –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –ï—Å–ª–∏ –≤—ã —Ö—Ä–∞–Ω–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ—Ç–∞—Ü–∏–∏ –æ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –≤ ImageMagick, —ç—Ç–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –¥–µ–ª–∞—Ç—å:

```diff
- variant(format: :jpg, rotate: rotation_value)
+ variant(format: :jpg)
```

#### –ó–∞–º–µ–Ω–∏—Ç–µ monochrome –Ω–∞ colourspace
Vips –¥—Ä—É–≥—É—é –æ–ø—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

```diff
- variant(monochrome: true)
+ variant(colourspace: "b-w")
```

#### –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –æ–ø—Ü–∏–∏ libvips –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

JPEG

```diff
- variant(strip: true, quality: 80, interlace: "JPEG", sampling_factor: "4:2:0", colorspace: "sRGB")
+ variant(saver: { strip: true, quality: 80, interlace: true })
```

PNG

```diff
- variant(strip: true, quality: 75)
+ variant(saver: { strip: true, compression: 9 })
```

WEBP

```diff
- variant(strip: true, quality: 75, define: { webp: { lossless: false, alpha_quality: 85, thread_level: 1 } })
+ variant(saver: { strip: true, quality: 75, lossless: false, alpha_q: 85, reduction_effort: 6, smart_subsample: true })
```

GIF

```diff
- variant(layers: "Optimize")
+ variant(saver: { optimize_gif_frames: true, optimize_gif_transparency: true })
```

#### –î–µ–ø–ª–æ–π –Ω–∞ production

Active Storage –∫–æ–¥–∏—Ä—É–µ—Ç –≤ url –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å. –ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫—ç—à–∏—Ä—É–µ—Ç —ç—Ç–∏ url, –≤–∞—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ–º–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ production. –ü–æ—ç—Ç–æ–º—É –≤–∞–º –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–ª—é—á–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä, –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –Ω–∞–ø–æ–¥–æ–±–∏–µ —ç—Ç–æ–≥–æ –≤–æ –≤—å—é:

```erb
<% @products.each do |product| %>
  <% cache product do %>
    <%= image_tag product.cover_photo.variant(resize: "200x") %>
  <% end %>
<% end %>
```

–ú–æ–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à, –ª–∏–±–æ –æ–±–Ω–æ–≤–∏–≤ product, –∏–ª–∏ –∏–∑–º–µ–Ω–∏–≤ –∫–ª—é—á –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```erb
<% @products.each do |product| %>
  <% cache ["v2", product] do %>
    <%= image_tag product.cover_photo.variant(resize_to_limit: [200, nil]) %>
  <% end %>
<% end %>
```

### –í–µ—Ä—Å–∏—è Rails —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –¥–∞–º–ø —Å—Ö–µ–º—ã Active Record

Rails 7.0 –∏–∑–º–µ–Ω—è–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–∏–ø–æ–≤ —Å—Ç–æ–ª–±—Ü–∞. –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª—è–µ–º–æ–µ —Å 6.1 –Ω–∞ 7.0, –∑–∞–≥—Ä—É–∂–∞–ª–æ —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–æ–≤—ã–µ —É–º–æ–ª—á–∞–Ω–∏—è –¥–ª—è 7.0, —Ç–µ–ø–µ—Ä—å Rails –≤–∫–ª—é—á–∞–µ—Ç –≤–µ—Ä—Å–∏—é —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –≤ –¥–∞–º–ø–µ —Å—Ö–µ–º—ã.

–î–æ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ö–µ–º—ã –≤ Rails 7.0, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `rails app:update` –≤–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã –≤–∫–ª—é—á–µ–Ω–∞ –≤ –¥–∞–º–ø —Å—Ö–µ–º—ã.

–§–∞–π–ª —Å—Ö–µ–º—ã –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```ruby
# This file is auto-generated from the current state of the database. Instead
# of editing this file, please use the migrations feature of Active Record to
# incrementally modify your database, and then regenerate this schema definition.
#
# This file is the source Rails uses to define your schema when running `bin/rails
# db:schema:load`. When creating a new database, `bin/rails db:schema:load` tends to
# be faster and is potentially less error prone than running all of your
# migrations from scratch. Old migrations may fail to apply correctly if those
# migrations use external dependencies or application code.
#
# It's strongly recommended that you check this file into your version control system.

ActiveRecord::Schema[6.1].define(version: 2022_01_28_123512) do
  # ...
end
```

NOTE: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–∞–º–ø–µ —Å—Ö–µ–º—ã —Å Rails 7.0, –≤—ã —É–≤–∏–¥–∏—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª, –≤–∫–ª—é—á–∞—è –Ω–µ–∫–æ—Ç–æ—Ä—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–æ–ª–±—Ü–∞—Ö. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã, –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –µ–≥–æ –≤ —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

(Upgrading from Rails 6.0 to Rails 6.1) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 6.0 –Ω–∞ Rails 6.1
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 6.1 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/6_1_release_notes).

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `Rails.application.config_for` –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π.

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:

```yaml
# config/example.yml
development:
  options:
    key: value
```

```ruby
Rails.application.config_for(:example).options
```

–†–∞–Ω—å—à–µ —ç—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ —Ö—ç—à, –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π. –≠—Ç–æ —É—Å—Ç–∞—Ä–µ–ª–æ –≤ 6.0, –∞ —Ç–µ–ø–µ—Ä—å –≤–æ–æ–±—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `with_indifferent_access` –Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ `config_for`, –µ—Å–ª–∏ –≤—Å–µ –µ—â–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º –∫–ª—é—á–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```ruby
Rails.application.config_for(:example).with_indifferent_access.dig('options', 'key')
```

### Content-Type –æ—Ç–∫–ª–∏–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `respond_to#any`

–ó–∞–≥–æ–ª–æ–≤–æ–∫ Content-Type, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –≤ –æ—Ç–∫–ª–∏–∫–µ, –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –≤ Rails 6.0, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `respond_to { |format| format.any }`.
–¢–µ–ø–µ—Ä—å Content-Type –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º –±–ª–æ–∫–µ, –∞ –Ω–µ —Ñ–æ—Ä–º–∞—Ç–µ –∑–∞–ø—Ä–æ—Å–∞.

Example:

```ruby
def my_action
  respond_to do |format|
    format.any { render(json: { foo: 'bar' }) }
    end
  end
end
```

```ruby
get('my_action.csv')
```

–ü—Ä–µ–∂–Ω–∏–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –±—ã–ª –≤–æ–∑–≤—Ä–∞—Ç `text/csv` –≤ Content-Type –æ—Ç–∫–ª–∏–∫–∞, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω—ã–º, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–Ω–¥–µ—Ä–∏–ª–∏ –æ—Ç–∫–ª–∏–∫ JSON. –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `application/json` –≤ Content-Type –æ—Ç–∫–ª–∏–∫–∞.

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–∞–≥–∞–ª–æ—Å—å –Ω–∞ –ø—Ä–µ–∂–Ω–µ–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–ª–µ–¥—É–µ—Ç —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–∞—à —ç–∫—à–Ω, —Ç.–µ.

```ruby
format.any(:xml, :json) { render request.format.to_sym => @people }
```

### `ActiveSupport::Callbacks#halted_callback_hook` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç

Active Support –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `halted_callback_hook` –¥–ª—è –≤—ã–∑–æ–≤–∞ –≤—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∫–æ–ª–±—ç–∫ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É. –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç, —è–≤–ª—è—é—â–∏–π—Å—è –∏–º–µ–Ω–µ–º –ø—Ä–µ—Ä—ã–≤–∞–µ–º–æ–≥–æ –∫–æ–ª–±—ç–∫–∞. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–ª–∞—Å—Å—ã, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞. –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏—è (–ø–æ –ø—Ä–∏—á–∏–Ω–∞–º –±—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏—è).

–ü—Ä–∏–º–µ—Ä:

```ruby
class Book < ApplicationRecord
  before_save { throw(:abort) }
  before_create { throw(:abort) }

  def halted_callback_hook(filter, callback_name) # => –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç 2 –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –≤–º–µ—Å—Ç–æ 1
    Rails.logger.info("Book couldn't be #{callback_name}d")
  end
end
```

### –ú–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ `helper` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `String#constantize`

–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ, –¥–æ Rails 6.1

```ruby
helper "foo/bar"
```

–ø—Ä–∏–≤–æ–¥–∏–ª –∫

```ruby
require_dependency "foo/bar_helper"
module_name = "foo/bar_helper".camelize
module_name.constantize
```

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, —Ç–µ–ø–µ—Ä—å –æ–Ω –¥–µ–ª–∞–µ—Ç —ç—Ç–æ:

```ruby
prefix = "foo/bar".camelize
"#{prefix}Helper".constantize
```

–≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏, –æ–¥–Ω–∞–∫–æ, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `helpers_path` –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ `$LOAD_PATH`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤ –ø—É—Ç—è—Ö –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏. –¢–∞–∫–æ–π —Å–ª—É—á–∞–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∫–æ—Ä–æ–±–∫–∏. –ï—Å–ª–∏ –º–æ–¥—É–ª—å —Ö–µ–ª–ø–µ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∫—É –¥–æ –≤—ã–∑–æ–≤–∞ `helper`.

### –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ HTTPS –æ—Ç HTTP —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å  308

–ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞ HTTP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ `ActionDispatch::SSL` –ø—Ä–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –Ω–µ-GET/HEAD –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç HTTP –∫ HTTPS –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `308`, –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤ https://tools.ietf.org/html/rfc7538.

### Active Storage —Ç–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç Image Processing

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ Active Storage, —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å [–≥–µ–º image_processing](https://github.com/janko/image_processing) –≤–º–µ—Å—Ç–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `mini_magick`. Image Processing –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `mini_magick` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –≥–µ–º `mini_magick` –Ω–∞ –≥–µ–º `image_processing`, –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É–±—Ä–∞–ª–∏ —è–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `combine_options`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ.

–î–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `resize` –Ω–∞ –º–∞–∫—Ä–æ—Å—ã `image_processing`. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ:

```ruby
video.preview(resize: "100x100")
video.preview(resize: "100x100>")
video.preview(resize: "100x100^")
```

–º–æ–∂–Ω–æ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —Å–¥–µ–ª–∞—Ç—å:

```ruby
video.preview(resize_to_fit: [100, 100])
video.preview(resize_to_limit: [100, 100])
video.preview(resize_to_fill: [100, 100])
```

### –ö–ª–∞—Å—Å `ActiveModel::Error`

–û—à–∏–±–∫–∏ —Ç–µ–ø–µ—Ä—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–ª–∞—Å—Å–∞ `ActiveModel::Error`, —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º API. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç–µ —Å –æ—à–∏–±–∫–∞–º–∏, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –¥—Ä—É–≥–∏–µ –±—É–¥—É—Ç –ø–µ—á–∞—Ç–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ—á–∏–Ω–∏—Ç—å –¥–ª—è Rails 7.0.

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ–± —ç—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ API –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ [–≤ —ç—Ç–æ–º PR](https://github.com/rails/rails/pull/32313).

(Upgrading from Rails 5.2 to Rails 6.0) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 5.2 –Ω–∞ Rails 6.0
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 6.0 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/6_0_release_notes).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Webpacker

[Webpacker](https://github.com/rails/webpacker) —ç—Ç–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä JavaScript –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Rails 6. –ù–æ –µ—Å–ª–∏ –≤—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –æ–Ω –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Webpacker, –≤–∫–ª—é—á–∏—Ç–µ –µ–≥–æ –≤ Gemfile –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```ruby
gem "webpacker"
```

```bash
$ bin/rails webpacker:install
```

### –ù–∞–≤—è–∑—ã–≤–∞–Ω–∏–µ SSL

–ú–µ—Ç–æ–¥ `force_ssl` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —É—Å—Ç–∞—Ä–µ–ª –∏ –±—É–¥–µ—Ç —É–±—Ä–∞–Ω –≤ Rails 6.1. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å [`config.force_ssl`][] –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è HTTPS –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ –æ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [`config.ssl_options`][] –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

[`config.force_ssl`]: /configuring#config-force-ssl
[`config.ssl_options`]: /configuring#config-ssl-options

### –î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–µ–ø–µ—Ä—å –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É–∫–∏

–ß—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, Rails –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∫—É–∫–∏.

–ó–∞—Ç–µ–º Rails –º–æ–∂–µ—Ç –ø–æ–º–µ—à–∞—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é –∞—Ç–∞–∫, –ø—ã—Ç–∞—é—â–∏—Ö—Å—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–µ/–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—É–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –∫—É–∫–∏.

–≠—Ç–∏ –Ω–æ–≤—ã–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–µ–ª–∞–µ—Ç –∫—É–∫–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ —Å –≤–µ—Ä—Å–∏—è–º–∏ Rails —Å—Ç–∞—Ä—à–µ —á–µ–º 6.0.

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –∫—É–∫–∏ —á–∏—Ç–∞–ª–∏—Å—å Rails 5.2 –∏ —Å—Ç–∞—Ä—à–µ, –∏–ª–∏ –≤—ã –≤—Å–µ –µ—â–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –¥–µ–ø–ª–æ–π 6.0 –∏ —Ö–æ—Ç–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `Rails.application.config.action_dispatch.use_cookies_with_metadata` –≤ `false`.

### –í—Å–µ –ø–∞–∫–µ—Ç—ã npm –±—ã–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω `@rails`

–ï—Å–ª–∏ –≤—ã —Ä–∞–Ω—å—à–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏ –ª—é–±—ã–µ –∏–∑ –ø–∞–∫–µ—Ç–æ–≤ `actioncable`, `activestorage` –∏–ª–∏ `rails-ujs` —Å –ø–æ–º–æ—â—å—é npm/yarn, –≤–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏–º–µ–Ω–∞ —ç—Ç–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–æ –∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ `6.0.0`:

```
actioncable   ‚Üí @rails/actioncable
activestorage ‚Üí @rails/activestorage
rails-ujs     ‚Üí @rails/ujs
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è Action Cable JavaScript API

–ü–∞–∫–µ—Ç Action Cable JavaScript –±—ã–ª –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ CoffeeScript –≤ ES2015, –∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ç–µ–ø–µ—Ä—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ npm.

–≠—Ç–æ—Ç —Ä–µ–ª–∏–∑ –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–ª–æ–º–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π Action Cable JavaScript API:

- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–∞–ø—Ç–µ—Ä–∞ WebSocket –∏ –∞–¥–∞–ø—Ç–µ—Ä–∞ –ª–æ–≥–≥–µ—Ä–∞ –±—ã–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –∏–∑ —Å–≤–æ–π—Å—Ç–≤ `ActionCable` –≤ —Å–≤–æ–π—Å—Ç–≤–∞ `ActionCable.adapters`. –ï—Å–ª–∏ –≤—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª–∏ —ç—Ç–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

    ```diff
    -    ActionCable.WebSocket = MyWebSocket
    +    ActionCable.adapters.WebSocket = MyWebSocket
    ```
    ```diff
    -    ActionCable.logger = myLogger
    +    ActionCable.adapters.logger = myLogger
    ```

- –ú–µ—Ç–æ–¥—ã `ActionCable.startDebugging()` –∏ `ActionCable.stopDebugging()` –±—ã–ª–∏ —É–±—Ä–∞–Ω—ã –∏ –∑–∞–º–µ–Ω–µ–Ω—ã —Å–≤–æ–π—Å—Ç–≤–æ–º `ActionCable.logger.enabled`. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç–∏ –º–µ—Ç–æ–¥—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

    ```diff
    -    ActionCable.startDebugging()
    +    ActionCable.logger.enabled = true
    ```
    ```diff
    -    ActionCable.stopDebugging()
    +    ActionCable.logger.enabled = false
    ```

### `ActionDispatch::Response#content_type` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Content-Type –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–†–∞–Ω–µ–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `ActionDispatch::Response#content_type` –ù–ï —Å–æ–¥–µ—Ä–∂–∞–ª–æ —á–∞—Å—Ç—å charset. –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ, —á—Ç–æ–±—ã —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–∞–Ω–µ–µ –æ–ø—É—Å–∫–∞–µ–º—É—é —á–∞—Å—Ç—å charset.

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º —Ç–æ–ª—å–∫–æ —Ç–∏–ø MIME, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ `ActionDispatch::Response#media_type`.

–î–æ:

```ruby
resp = ActionDispatch::Response.new(200, "Content-Type" => "text/csv; header=present; charset=utf-16")
resp.content_type #=> "text/csv; header=present"
```

–ü–æ—Å–ª–µ:

```ruby
resp = ActionDispatch::Response.new(200, "Content-Type" => "text/csv; header=present; charset=utf-16")
resp.content_type #=> "text/csv; header=present; charset=utf-16"
resp.media_type   #=> "text/csv"
```

### –ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `config.hosts`

–í Rails —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å –Ω–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `config.hosts` –¥–ª—è —Ü–µ–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `localhost` –≤ development. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–∏–µ –¥–æ–º–µ–Ω—ã –≤ development, –≤–∞–º –Ω—É–∂–Ω–æ –∏—Ö —Ä–∞–∑—Ä–µ—à–∏—Ç—å:

```ruby
# config/environments/development.rb

config.hosts << 'dev.myapp.com'
config.hosts << /[a-z0-9-]+\.myapp\.com/ # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω regexp
```

–î–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ä–µ–¥ `config.hosts` –ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Rails –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ö–æ—Å—Ç –≤–æ–æ–±—â–µ. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –∏—Ö –¥–æ–±–∞–≤–∏—Ç—å, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Ö –≤ production.

### (autoloading) –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Rails 6

```ruby
# config/application.rb

config.load_defaults 6.0
```

–≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ `zeitwerk` –Ω–∞ CRuby. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è [Zeitwerk](https://github.com/fxn/zeitwerk).

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —É–º–æ–ª—á–∞–Ω–∏—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ Rails, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å zeitwerk —Ç–∞–∫:

```ruby
# config/application.rb

config.autoloader = :zeitwerk
```

#### –ü—É–±–ª–∏—á–Ω—ã–π API

–í —Ü–µ–ª–æ–º, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –Ω–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API Zeitwerk –Ω–∞–ø—Ä—è–º—É—é. Rails –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏: `config.autoload_paths`, `config.cache_classes` –∏ —Ç.–¥.

–•–æ—Ç—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏ Zeitwerk –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫

```ruby
Rails.autoloaders.main
```

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–æ–±–Ω—ã–º, –∫ –ø—Ä–∏–º–µ—Ä—É, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å –µ–¥–∏–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π (Single Table Inheritance, STI) –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ñ–ª–µ–∫—Ç–æ—Ä.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ï—Å–ª–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π.

–û–¥–Ω–∞–∫–æ, —Ä–µ–∂–∏–º `classic` –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ –∏–º–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç (`underscore`), –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ —Ä–µ–∂–∏–º `zeitwerk` –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–º–µ–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏–∑ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (`camelize`). –≠—Ç–∏ —Ö–µ–ª–ø–µ—Ä—ã –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã –¥—Ä—É–≥ –¥—Ä—É–≥—É, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä, `"FOO".underscore` —ç—Ç–æ `"foo"`, –Ω–æ `"foo".camelize` —ç—Ç–æ `"Foo"`, –∞ –Ω–µ `"FOO"`.

–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –∑–∞–¥–∞—á–∏ `zeitwerk:check`:

```bash
$ bin/rails zeitwerk:check
Hold on, I am eager loading the application.
All is good!
```

#### require_dependency

–í—Å–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å–ª—É—á–∞–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π `require_dependency` –±—ã–ª–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, —Å–ª–µ–¥—É–µ—Ç –Ω–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å –∏—Ö –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ.

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å Single Table Inheritance, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ [—Ä–∞–∑–¥–µ–ª –æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ —Å –µ–¥–∏–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π](/autoloading-and-reloading-constants#single-table-inheritance) —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç (—Ä–µ–∂–∏–º Zeitwerk).

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö –∫–ª–∞—Å—Å–∞ –∏ –º–æ–¥—É–ª—è

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö –∫–ª–∞—Å—Å–∞ –∏ –º–æ–¥—É–ª—è:

```ruby
# –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –≤ —Ç–µ–ª–µ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫–µ Ruby.
class Admin::UsersController < ApplicationController
  # ...
end
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å, –æ –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –≤ —Ç–æ–º, —á—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫ –º–æ–≥ –∏–Ω–æ–≥–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å `Foo::Wadus` –≤

```ruby
class Foo::Bar
  Wadus
end
```

–≠—Ç–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫–µ Ruby, —Ç–∞–∫ –∫–∞–∫ `Foo` –Ω–µ –≤–æ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏, –∏ —ç—Ç–æ –≤–æ–æ–±—â–µ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ `zeitwerk`. –ï—Å–ª–∏ –≤—ã –Ω–∞–π–¥–µ—Ç–µ —Ç–∞–∫–∏–µ —á–∞—Å—Ç–Ω—ã–µ —Å–ª—É—á–∞–∏, –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏–º—è `Foo::Wadus`:

```ruby
class Foo::Bar
  Foo::Wadus
end
```

–∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `Foo` –≤–æ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å:

```ruby
module Foo
  class Bar
    Wadus
  end
end
```

#### –ö–æ–Ω—Ü–µ—Ä–Ω—ã

–ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –Ω–∞–ø–æ–¥–æ–±–∏–µ

```
app/models
app/models/concerns
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, `app/models/concerns` –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π (—Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—É—Ç—è–º –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏), –∏ –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω. –ü–æ—ç—Ç–æ–º—É, `app/models/concerns/foo.rb` –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å `Foo`, –∞ –Ω–µ `Concerns::Foo`.

–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω `Concerns::` —Ä–∞–±–æ—Ç–∞–ª–æ —Å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–º –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º –∫–∞–∫ –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ –∂–µ–ª–∞–µ–º—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–µ `Concerns::`, –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –º–æ–¥—É–ª–µ–π, —á—Ç–æ–±—ã –∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ `zeitwerk`.

#### `app` –≤ –ø—É—Ç—è—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∫–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–µ–ª–∏ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `app/api/base.rb` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `API::Base`, —Ç–æ –¥–æ–±–∞–≤–ª—è–ª–∏ `app` –≤ –ø—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏, –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ –≤ —Ä–µ–∂–∏–º–µ `classic`. –° —Ç–µ—Ö –ø–æ—Ä, –∫–∞–∫ Rails –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `app` –≤ –ø—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏, —É –Ω–∞—Å —Ç–µ–ø–µ—Ä—å –¥—Ä—É–≥–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ—Ä–Ω–µ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø–æ—ç—Ç–æ–º—É —Ç–∞–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–æ—Ö–æ–∂–∏–π –ø—Ä–∏–Ω—Ü–∏–ø –º—ã –æ–±—ä—è—Å–Ω–∏–ª–∏ –≤—ã—à–µ –ø—Ä–æ `concerns`.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–∑ –ø—É—Ç–µ–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–µ:

```ruby
ActiveSupport::Dependencies.autoload_paths.delete("#{Rails.root}/app/api")
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ —è–≤–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω

–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤ —Ñ–∞–π–ª–µ, –∫–∞–∫ `Hotel` —Ç—É—Ç:

```
app/models/hotel.rb         # Defines Hotel.
app/models/hotel/pricing.rb # Defines Hotel::Pricing.
```

–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `Hotel` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ `class` –∏–ª–∏ `module`. –ù–∞–ø—Ä–∏–º–µ—Ä:

```ruby
class Hotel
end
```

—ç—Ç–æ —Ö–æ—Ä–æ—à–æ.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –Ω–∞–ø–æ–¥–æ–±–∏–µ

```ruby
Hotel = Class.new
```

–∏–ª–∏

```ruby
Hotel = Struct.new
```

–Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–æ—á–µ—Ä–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ `Hotel::Pricing`, –Ω–µ –±—É–¥—É—Ç –Ω–∞–π–¥–µ–Ω—ã.

–≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —è–≤–Ω—ã–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º –∏–º–µ–Ω. –ö–ª–∞—Å—Å—ã –∏ –º–æ–¥—É–ª–∏, –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω, –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é —ç—Ç–∏—Ö –∏–¥–∏–æ–º.

#### –û–¥–∏–Ω —Ñ–∞–π–ª, –æ–¥–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ (–Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ)

–í —Ä–µ–∂–∏–º–µ `classic` —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –±—ã–ª–æ –≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, –∏ –æ–Ω–∏ –≤—Å–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è

```ruby
# app/models/foo.rb

class Foo
end

class Bar
end
```

—Ö–æ—Ç—è `Bar` –Ω–µ –º–æ–≥ –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω, –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ `Foo` —Ç–∞–∫–∂–µ –ø–æ–º–µ—á–∞–ª–∞ `Bar` –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π. –≠—Ç–æ –Ω–µ —Ç–∞–∫ –≤ —Ä–µ–∂–∏–º–µ `zeitwerk`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `Bar` –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `bar.rb`. –û–¥–∏–Ω —Ñ–∞–π–ª, –æ–¥–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞.

–≠—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, –∫–∞–∫ –≤ –≤—ã—à–µ–æ–ø–∏—Å–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∞—Å—Å—ã –∏ –º–æ–¥—É–ª–∏ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º

```ruby
# app/models/foo.rb

class Foo
  class InnerClass
  end
end
```

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç `Foo`, –æ–Ω–æ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç `Foo::InnerClass`.

#### Spring –∏ —Å—Ä–µ–¥–∞ `test`

Spring –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è. –í —Å—Ä–µ–¥–µ `test` –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É, —á—Ç–æ–±—ã —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ:

```ruby
# config/environments/test.rb

config.cache_classes = false
```

–ò–Ω–∞—á–µ, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Ç–∞–∫—É—é –æ—à–∏–±–∫—É:

```
reloading is disabled because config.cache_classes is true
```

#### Bootsnap

Bootsnap –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º –≤–µ—Ä—Å–∏–∏ 1.4.2.

–ü–æ–º–∏–º–æ —ç—Ç–æ–≥–æ, –¥–ª—è Bootsnap –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à iseq –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –≤ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–µ, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Ruby 2.5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≤–∏—Å–∏–º—ã –æ—Ç –º–∏–Ω–∏–º—É–º Bootsnap 1.4.4 –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ.

#### `config.add_autoload_paths_to_load_path`

–ù–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç [`config.add_autoload_paths_to_load_path`][] –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–π—Ç–∏ –æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—É—Ç–µ–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –≤ `$LOAD_PATH`.

–≠—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ª–µ–¥—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ñ–∞–π–ª –≤ `app/models`, –∫ –ø—Ä–∏–º–µ—Ä—É, –∏ Zeitwerk –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤.

–£—Ö–æ–¥—è –æ—Ç —ç—Ç–æ–≥–æ, –≤—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç–µ –ø–æ–∏—Å–∫ `$LOAD_PATH` (–º–µ–Ω—å—à–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏), –∏ —ç–∫–æ–Ω–æ–º–∏—Ç–µ —Ä–∞–±–æ—Ç—É Bootsnap –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –µ–º—É –Ω–µ –Ω—É–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è —ç—Ç–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.

[`config.add_autoload_paths_to_load_path`]: /configuring#config-add-autoload-paths-to-load-path

#### –¢—Ä–µ–¥–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ç—Ä–µ–¥–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π, —Ö–æ—Ç—è –≤ Rails –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –≤–µ–± –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–¥–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏, –∫–æ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø—Ä–∏–Ω—è—Ç–æ –≤ —Å—Ä–µ–¥–µ development.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —Ç—Ä–µ–¥–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤ —Ä–µ–∂–∏–º–µ `zeitwerk`. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ –º–Ω–æ–≥–æ—Ç—Ä–µ–¥–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö, –∑–∞–ø—É—Å–∫–∞–µ–º—ã—Ö —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `runner`.

#### –®–∞–±–ª–æ–Ω—ã –ø–æ–∏—Å–∫–∞ –≤ config.autoload_paths

–û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫

```ruby
config.autoload_paths += Dir["#{config.root}/lib/**/"]
```

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç `config.autoload_paths` –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è (`Object`) –∏ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ (—Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π `concerns`, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤—ã—à–µ).

–ß—Ç–æ–±—ã —ç—Ç–æ –ø–æ—á–∏–Ω–∏—Ç—å, –ø—Ä–æ—Å—Ç–æ —É–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏:

```ruby
config.autoload_paths << "#{config.root}/lib"
```

#### –ù–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ–≥–ª–∞—Å—É—é—Ç—Å—è

–í —Ä–µ–∂–∏–º–µ `classic`, –µ—Å–ª–∏ `app/models/foo.rb` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `Bar`, –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª, –Ω–æ –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –≤—Å–ª–µ–ø—É—é. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –æ—à–∏–±–æ–∫, –µ—Å–ª–∏ –≤—ã —Å–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ —Å –ø–æ–º–æ—â—å—é –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.

–í —Ä–µ–∂–∏–º–µ `zeitwerk` –æ–±–∞ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–≥–ª–∞—Å—É—é—Ç—Å—è, –æ–Ω–∏ –≤—ã–¥–∞–¥—É—Ç –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Ö –∂–µ —Ñ–∞–π–ª–∞—Ö.

#### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫ –≤ Rails 6

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —É–º–æ–ª—á–∞–Ω–∏—è Rails 6 –∏ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫, –Ω–∞—Å—Ç—Ä–æ–∏–≤ `config.autoloader` —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```ruby
# config/application.rb

config.load_defaults 6.0
config.autoloader = :classic
```

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Classic Autoloader –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Rails 6 —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å concurrency –Ω–∞ 1 –≤ —Å—Ä–µ–¥–µ development, –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º —Ç—Ä–µ–¥–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è Active Storage

–° –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Rails 5.2, –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–∏–π, –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–µ —Å –ø–æ–º–æ—â—å—é `has_many_attached`, –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

```ruby
class User < ApplicationRecord
  has_many_attached :highlights
end

user.highlights.attach(filename: "funky.jpg")
user.highlights.count # => 1

blob = ActiveStorage::Blob.create_after_upload!(filename: "town.jpg")
user.update!(highlights: [ blob ])

user.highlights.count # => 2
user.highlights.first.filename # => "funky.jpg"
user.highlights.second.filename # => "town.jpg"
```

–° –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Rails 6.0, –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–∏–π –∑–∞–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤–º–µ—Å—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ –Ω–∏–º. –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—é Active Record –ø—Ä–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–∏ –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏:

```ruby
user.highlights.attach(filename: "funky.jpg")
user.highlights.count # => 1

blob = ActiveStorage::Blob.create_after_upload!(filename: "town.jpg")
user.update!(highlights: [ blob ])

user.highlights.count # => 1
user.highlights.first.filename # => "town.jpg"
```

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `#attach`:

```ruby
blob = ActiveStorage::Blob.create_after_upload!(filename: "town.jpg")
user.highlights.attach(blob)

user.highlights.count # => 2
user.highlights.first.filename # => "funky.jpg"
user.highlights.second.filename # => "town.jpg"
```

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –≤–∫–ª—é—á–∏—Ç—å —ç—Ç–æ –Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∏–≤ [`config.active_storage.replace_on_assign_to_many`][] –≤ `true`. –°—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—É–¥–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –≤ Rails 7.0 –∏ —É–±—Ä–∞–Ω–æ –≤ Rails 7.1.

[`config.active_storage.replace_on_assign_to_many`]: /configuring#config-active-storage-replace-on-assign-to-many

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ `Accept` –∏–ª–∏ `Content-Type` —Ç–µ–ø–µ—Ä—å –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é [`config.exceptions_app`][] —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç—É –æ—à–∏–±–∫—É –∏ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –µ–µ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É, –∏–Ω–∞—á–µ —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–∑–æ–≤—É—Ç —Ç–æ, —á—Ç–æ Rails –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–µ `500 Internal Server Error`.

[`config.exceptions_app`]: /configuring#config-exceptions-app

(Upgrading from Rails 5.1 to Rails 5.2) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 5.1 –Ω–∞ Rails 5.2
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 5.2 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/5_2_release_notes).

### Bootsnap

Rails 5.2 –¥–æ–±–∞–≤–ª—è–µ—Ç –≥–µ–º bootsnap –≤–æ [–≤–Ω–æ–≤—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Gemfile –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](https://github.com/rails/rails/pull/29313).
–ö–æ–º–∞–Ω–¥–∞ `app:update` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –µ–≥–æ –≤ `boot.rb`. –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ, –¥–æ–±–∞–≤—å—Ç–µ –≤ Gemfile:

```ruby
# Reduces boot times through caching; required in config/boot.rb
gem "bootsnap", require: false
```

–ò–Ω–∞—á–µ –∏–∑–º–µ–Ω–∏—Ç–µ `boot.rb`, —á—Ç–æ–±—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bootsnap.

### –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É–∫–∏ —Ç–µ–ø–µ—Ä—å –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∑–Ω–∞—á–µ–Ω–∏—è –∫—É–∫–∏

–ß—Ç–æ–±—ã –ø–æ–≤—ã—Å–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, Rails —Ç–µ–ø–µ—Ä—å –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–∞–∫–∂–µ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—É–∫–∏.

–≠—Ç–∞ –Ω–æ–≤–∞—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–µ–ª–∞–µ—Ç —ç—Ç–∏ –∫—É–∫–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ —Å –≤–µ—Ä—Å–∏—è–º–∏ Rails –¥–æ 5.2.

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –∫—É–∫–∏ —á–∏—Ç–∞–ª–∏—Å—å –≤ –≤–µ—Ä—Å–∏–∏ 5.1 –∏ —Ä–∞–Ω—å—à–µ, –∏–ª–∏ –µ—Å–ª–∏ –≤—Å–µ –µ—â–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–µ–ø–ª–æ–π 5.2 –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å—Ç–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∞—Ç—å –æ—Ç–∫–∞—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `Rails.application.config.action_dispatch.use_authenticated_cookie_encryption` –≤ `false`.

(Upgrading from Rails 5.0 to Rails 5.1) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 5.0 –Ω–∞ Rails 5.1
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 5.1 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/5_1_release_notes).

### –í–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–π `HashWithIndifferentAccess` –≤ —Å–∫–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏ —É—Å—Ç–∞—Ä–µ–µ—Ç.

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–ª–∞—Å—Å `HashWithIndifferentAccess`, —Ç–æ –≤–∞–º —Å–ª–µ–¥—É–µ—Ç –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ `ActiveSupport::HashWithIndifferentAccess`.

–≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞—à –∫–æ–¥ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞—Ç—å—Å—è –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∏ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏, –Ω–æ —ç—Ç–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –µ—Å–ª–∏ –∏–º–µ—é—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ —Å—Ç–∞—Ä—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã YAML, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –≤—ã–≥—Ä—É–∑–∫–∏ —Ç–∞–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏ –≤—ã–≥—Ä—É–∑–∏—Ç—å –∏—Ö —Å–Ω–æ–≤–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –∏ —á—Ç–æ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞—Ç—å—Å—è –≤ –±—É–¥—É—â–µ–º.

### `application.secrets` —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–æ –≤—Å–µ–º–∏ –∫–ª—é—á–∞–º–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–∏–º–≤–æ–ª–æ–≤

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç –≤–ª–æ–∂–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `config/secrets.yml`, –≤—Å–µ –∫–ª—é—á–∏ —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–∞–∫ —Å–∏–º–≤–æ–ª—ã, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç—É–ø —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω.

–°:

```ruby
Rails.application.secrets[:smtp_settings]["address"]
```

–ù–∞:

```ruby
Rails.application.secrets[:smtp_settings][:address]
```

### –£–±—Ä–∞–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `:text` –∏ `:nothing` –≤ `render`

–ï—Å–ª–∏ –≤–∞—à–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `render :text`, –æ–Ω–∏ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –≤—å—é —Å —Ç–∏–ø–æ–º MIME `text/plain` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `render :plain`.

–ü–æ—Ö–æ–∂–∏–º –æ–±—Ä–∞–∑–æ–º, `render :nothing` —Ç–∞–∫–∂–µ —É–±—Ä–∞–Ω, –∏ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `head` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∫–ª–∏–∫–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, `head :ok` –ø–æ—Å—ã–ª–∞–µ—Ç –æ—Ç–∫–ª–∏–∫ 200 –±–µ–∑ —Ç–µ–ª–∞.

### –£–±—Ä–∞–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `redirect_to :back`

–í Rails 5.0, `redirect_to :back` —É—Å—Ç–∞—Ä–µ–ª. –í Rails 5.1 –æ–Ω –±—ã–ª —É–±—Ä–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é.

–í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `redirect_back`. –í–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ `redirect_back` —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–ø—Ü–∏—é `fallback_location`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è `HTTP_REFERER`.

```ruby
redirect_back(fallback_location: root_path)
```

(Upgrading from Rails 4.2 to Rails 5.0) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 4.2 –Ω–∞ Rails 5.0
------------------------------------------------------------------------

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ Rails 5.0 —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–∑–∞–º–µ—Ç–∫–∞—Ö –æ —Ä–µ–ª–∏–∑–µ](/5_0_release_notes).

### –¢—Ä–µ–±—É–µ—Ç—Å—è Ruby 2.2.2+

–ù–∞—á–∏–Ω–∞—è —Å Ruby on Rails 5.0, Ruby 2.2.2+ —è–≤–ª—è—é—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Ruby. –ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞ Ruby –≤–µ—Ä—Å–∏–∏ 2.2.2 –∏–ª–∏ –≤—ã—à–µ.

### –ú–æ–¥–µ–ª–∏ Active Record —Ç–µ–ø–µ—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç ApplicationRecord

–í Rails 4.2 –º–æ–¥–µ–ª—å Active Record –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `ActiveRecord::Base`. –í Rails 5.0 –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `ApplicationRecord`.

`ApplicationRecord` - —ç—Ç–æ –Ω–æ–≤—ã–π —Å—É–ø–µ—Ä–∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–º –æ—Ç `ApplicationController` –≤–º–µ—Å—Ç–æ `ActionController::Base`. –≠—Ç–æ –¥–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –µ–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

–ü—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ —Å Rails 4.2 –Ω–∞ Rails 5.0 –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `application_record.rb` –≤ `app/models/` –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```ruby
class ApplicationRecord < ActiveRecord::Base
  self.abstract_class = true
end
```

–ó–∞—Ç–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –≤–∞—à–∏ –º–æ–¥–µ–ª–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç –Ω–µ–≥–æ.

### –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫ –∫–æ–ª–±—ç–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é `throw(:abort)`

–í Rails 4.2 –≤ Active Record –∏ Active Model, –∫–æ–≥–¥–∞ –∫–æ–ª–±—ç–∫ 'before' –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`, –≤—Å—è —Ü–µ–ø–æ—á–∫–∞ —Ü–µ–ø–æ—á–∫–∞ –∫–æ–ª–±—ç–∫–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–ª–∞—Å—å. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–ª–±—ç–∫–∏ 'before' –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å, –∫–∞–∫ –∏ —ç–∫—à–Ω, –æ–±–µ—Ä–Ω—É—Ç—ã–π –≤ –∫–æ–ª–±—ç–∫–∏.

–í Rails 5.0, –≤–æ–∑–≤—Ä–∞—Ç `false` –∫–æ–ª–±—ç–∫–æ–º Active Record –∏–ª–∏ Active Model –Ω–µ –±—É–¥–µ—Ç –∏–º–µ—Ç—å —ç—Ç–æ–≥–æ –ø–æ–±–æ—á–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –∫–æ–ª–±—ç–∫–æ–≤. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, —Ü–µ–ø–æ—á–∫–∏ –∫–æ–ª–±—ç–∫–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —è–≤–Ω–æ –ø—Ä–µ—Ä–≤–∞–Ω—ã –≤—ã–∑–æ–≤–æ–º `throw(:abort)`.

–ü—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ —Å Rails 4.2 –Ω–∞ Rails 5.0, –≤–æ–∑–≤—Ä–∞—Ç `false` –≤ —ç—Ç–∏—Ö —Ç–∏–ø–∞—Ö –∫–æ–ª–±—ç–∫–æ–≤ –≤—Å–µ –µ—â–µ –±—É–¥–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Ü–µ–ø–æ—á–∫—É –∫–æ–ª–±—ç–∫–æ–≤, –Ω–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏ –æ–± —ç—Ç–æ–º –≥—Ä—è–¥—É—â–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏.

–ö–æ–≥–¥–∞ –≤—ã –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —É–±—Ä–∞—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏, –¥–æ–±–∞–≤–∏–≤ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `config/application.rb`:

```ruby
ActiveSupport.halt_callback_chains_on_return_false = false
```

–û—Ç–º–µ—Ç–∏–º, —á—Ç–æ —ç—Ç–∞ –æ–ø—Ü–∏—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–ª–±—ç–∫–∏ Active Support, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–ª–∏—Å—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ [#17227](https://github.com/rails/rails/pull/17227).

### ActiveJob —Ç–µ–ø–µ—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ApplicationJob

–í Rails 4.2 Active Job –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `ActiveJob::Base`. –í Rails 5.0 —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç `ApplicationJob`.

–ü—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ —Å Rails 4.2 –Ω–∞ Rails 5.0 –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `application_job.rb` –≤ `app/jobs/` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```ruby
class ApplicationJob < ActiveJob::Base
end
```

–ó–∞—Ç–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–ª–∞—Å—Å—ã –∑–∞–¥–∞–Ω–∏–π –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç –Ω–µ–≥–æ.

–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ [#19034](https://github.com/rails/rails/pull/19034).

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ Rails

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Ö–µ–ª–ø–µ—Ä–∞ –≤ `rails-controller-testing`

`assigns` –∏ `assert_template` –±—ã–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã –≤ –≥–µ–º `rails-controller-testing`. –ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤, –¥–æ–±–∞–≤—å—Ç–µ `gem "rails-controller-testing"` –≤ —Å–≤–æ–π `Gemfile`.

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ RSpec –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≥–µ–º–∞ –ø–æ —Ç—Ä–µ–±—É–µ–º–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

#### –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `ActionDispatch::Http::UploadedFile` –≤ —Å–≤–æ–∏—Ö —Ç–µ—Å—Ç–∞—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤, —Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∫–ª–∞—Å—Å `Rack::Test::UploadedFile`.

–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ [#26404](https://github.com/rails/rails/issues/26404).

### –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Å—Ä–µ–¥–µ production

–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Å—Ä–µ–¥–µ production –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ù–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - —ç—Ç–æ —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –∏—Ö —Ñ–∞–π–ª—ã –Ω–µ –Ω—É–∂–Ω–æ —Ç—Ä–µ–±–æ–≤–∞—Ç—å.

–ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–±—ã—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏—Ö —Ñ–∞–π–ª –±—ã–ª –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∏ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.

–î–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–∞–∫–∏—Ö-–ª–∏–±–æ –¥–µ–π—Å—Ç–≤–∏–π. –ù–æ, –≤ –æ—á–µ–Ω—å —Ä–µ–¥–∫–æ–º —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –≤–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –≤ production, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `Rails.application.config.enable_dependency_loading` –≤ true.

### –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ XML

`ActiveModel::Serializers::Xml` –±—ã–ª –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ Rails –≤ –≥–µ–º `activemodel-serializers-xml`. –ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ XML –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –¥–æ–±–∞–≤—å—Ç–µ `gem "activemodel-serializers-xml"`–≤ —Å–≤–æ–π `Gemfile`.

### –£–±—Ä–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –∞–¥–∞–ø—Ç–µ—Ä–∞ `mysql`

–í Rails 5 —É–±—Ä–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –∞–¥–∞–ø—Ç–µ—Ä–∞ –ë–î `mysql`. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ `mysql2`. –û–Ω –±—É–¥–µ—Ç —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–µ–º, –µ—Å–ª–∏ –Ω–∞–π–¥–µ—Ç—Å—è –∫—Ç–æ-—Ç–æ –¥–ª—è –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

### –£–±—Ä–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Debugger

`debugger` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Ruby 2.2, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è Rails 5. –í–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `byebug`.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `bin/rails` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á –∏ —Ç–µ—Å—Ç–æ–≤

Rails 5 –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏ —Ç–µ—Å—Ç—ã —Å –ø–æ–º–æ—â—å—é `bin/rails` –≤–º–µ—Å—Ç–æ rake. –í –æ—Å–Ω–æ–≤–Ω–æ–º —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—ã–ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å rake, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é.

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ `bin/rails test`.

`rake dev:cache` —Ç–µ–ø–µ—Ä—å `bin/rails dev:cache`.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ `bin/rails` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.

### `ActionController::Parameters` –±–æ–ª—å—à–µ –Ω–µ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `HashWithIndifferentAccess`

–í—ã–∑–æ–≤ `params` –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ —Ö—ç—à. –ï—Å–ª–∏ –≤–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∂–µ –¥–æ–∑–≤–æ–ª–µ–Ω—ã, –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤–Ω–æ—Å–∏—Ç—å –∫–∞–∫–∏—Ö-–ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `map` –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã, –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —á–∏—Ç–∞—Ç—å —Ö—ç—à, –Ω–µ —Å–º–æ—Ç—Ä—è –Ω–∞ `permitted?`, –Ω—É–∂–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞—Ç—å permit, –∞ –∑–∞—Ç–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ö—ç—à.

```ruby
params.permit([:proceed_to, :return_to]).to_h
```

### –¢–µ–ø–µ—Ä—å –≤ `protect_from_forgery` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `prepend: false`

`protect_from_forgery` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `prepend: false`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω –±—É–¥–µ–Ω –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ —Ü–µ–ø–æ—á–∫—É –∫–æ–ª–±—ç–∫–æ–≤ –≤ —Ç–æ–º –º–µ—Å—Ç–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã `protect_from_forgery` –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –ø–µ—Ä–≤—ã–º, —Å–ª–µ–¥—É–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `protect_from_forgery prepend: true`.

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —à–∞–±–ª–æ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–ø–µ—Ä—å RAW

–§–∞–π–ª—ã –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —à–∞–±–ª–æ–Ω–∞ –≤ –∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –±—É–¥—É—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è —Å –ø–æ–º–æ—â—å—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ raw. –†–∞–Ω—å—à–µ Rails —Ä–µ–Ω–¥–µ—Ä–∏–ª –±—ã —Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —à–∞–±–ª–æ–Ω–∞ ERB.

–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –≤–∞—à —Ñ–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è —Å –ø–æ–º–æ—â—å—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ raw, —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫ —Å–≤–æ–µ–º—É —Ñ–∞–π–ª—É, —á—Ç–æ–±—ã –æ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ–¥—Ö–æ–¥—è—â–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —à–∞–±–ª–æ–Ω–∞.

### –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —à–∞–±–ª–æ–Ω–æ–≤

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤–∞—à–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –æ–ø—Ä–µ–¥–µ–ª—è–ª–∏ –≤–∞—à–∏ —à–∞–±–ª–æ–Ω—ã —Ç–∞–∫:

```erb
<% # Template Dependency: recordings/threads/events/subscribers_changed %>
<% # Template Dependency: recordings/threads/events/completed %>
<% # Template Dependency: recordings/threads/events/uncompleted %>
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –µ–¥–∏–Ω–æ–∂–¥—ã —Å –ø–æ–º–æ—â—å—é —Å–∏–º–≤–æ–ª–∞ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏.

```erb
<% # Template Dependency: recordings/threads/events/* %>
```

### `ActionView::Helpers::RecordTagHelper` –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–µ–º (record_tag_helper)

`content_tag_for` –∏ `div_for` –±—ã–ª–∏ —É–±—Ä–∞–Ω—ã –≤ –ø–æ–ª—å–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `content_tag`. –ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –¥–æ–±–∞–≤—å—Ç–µ –≥–µ–º `record_tag_helper` –≤ —Å–≤–æ–π `Gemfile`:

```ruby
gem "record_tag_helper", "~> 1.0"
```

–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ [#18411](https://github.com/rails/rails/issues/18411).

### –£–±—Ä–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–º–∞ `protected_attributes`

–ì–µ–º `protected_attributes` –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ Rails 5.

### –£–±—Ä–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–º–∞ `activerecord-deprecated_finders`

–ì–µ–º `activerecord-deprecated_finders` –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ Rails 5.

### –ü–æ—Ä—è–¥–æ–∫ —Ç–µ—Å—Ç–æ–≤ `ActiveSupport::TestCase` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–π—á–∞—Å —Å–ª—É—á–∞–π–Ω—ã–π

–ö–æ–≥–¥–∞ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã, –ø–æ—Ä—è–¥–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–π—á–∞—Å `:random` –≤–º–µ—Å—Ç–æ `:sorted`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –æ–ø—Ü–∏—é, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `:sorted` –æ–±—Ä–∞—Ç–Ω–æ.

```ruby
# config/environments/test.rb
Rails.application.configure do
  config.active_support.test_order = :sorted
end
```

### `ActionController::Live` —Å—Ç–∞–ª `Concern`

–ï—Å–ª–∏ –≤—ã –≤–∫–ª—é—á–∞–ª–∏ `ActionController::Live` –≤ –¥—Ä—É–≥–æ–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–ª—Å—è –≤ –≤–∞—à –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, —Ç–æ –≤—ã —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥—É–ª—å —Å –ø–æ–º–æ—â—å—é `ActiveSupport::Concern`. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö—É–∫ `self.included`, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å `ActionController::Live` –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á–∏—Ç—Å—è `StreamingSupport`.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏, —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ —Å–ª–æ–º–∞–µ—Ç—Å—è –≤ production:

```ruby
# –≠—Ç–æ –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é Warden/Devise.
# –°–º–æ—Ç—Ä–∏—Ç–µ https://github.com/plataformatec/devise/issues/2332
# –î—Ä—É–≥–∏–º —Ä–µ—à–µ–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ —Ä–æ—É—Ç–µ—Ä–µ, –∫–∞–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤ —Ç—â–π –ø—Ä–æ–±–ª–µ–º–µ
class StreamingSupport
  include ActionController::Live # —ç—Ç–æ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ production –¥–ª—è Rails 5
  # extend ActiveSupport::Concern # –ø–æ–∫–∞ –≤—ã –Ω–µ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ—á–∫—É.
  def process(name)
    super(name)
  rescue ArgumentError => e
    if e.message == 'uncaught throw :warden'
      throw :warden
    else
      raise e
    end
  end
end
```

### –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞

#### –û–ø—Ü–∏—è Active Record –¥–ª—è `belongs_to` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

`belongs_to` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –µ—Å–ª–∏ —Å–≤—è–∑—å –Ω–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

–≠—Ç–æ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏ —Å –ø–æ–º–æ—â—å—é `optional: true`.

–≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç—É –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å, –µ–µ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–µ.

```ruby
config.active_record.belongs_to_required_by_default = true
```

–≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥–ª–æ–±–∞–ª—å–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π, –Ω–æ –µ–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –º–æ–¥–µ–ª–∏. –≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–∞—à–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ —Å–≤—è–∑–∏, —Ç—Ä–µ–±—É–µ–º—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```ruby
class Book < ApplicationRecord
  # –º–æ–¥–µ–ª—å –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ —Å–≤—è–∑—è–º, —Ç—Ä–µ–±—É–µ–º—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

  self.belongs_to_required_by_default = false
  belongs_to(:author)
end

class Car < ApplicationRecord
  # –º–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ —Å–≤—è–∑—è–º, —Ç—Ä–µ–±—É–µ–º—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

  self.belongs_to_required_by_default = true
  belongs_to(:pilot)
end
```

#### –¢–æ–∫–µ–Ω—ã CSRF –¥–ª—è —Ñ–æ—Ä–º—ã

Rails 5 —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã CSRF –¥–ª—è —Ñ–æ—Ä–º—ã, —á—Ç–æ–±—ã –æ—Å–ª–∞–±–∏—Ç—å –∞—Ç–∞–∫–∏ —Å –ø–æ–º–æ—â—å—é –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∫–æ–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–æ—Ä–º, —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ JavaScript. –°–æ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ–ø—Ü–∏–µ–π —Ñ–æ—Ä–º—ã –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∏–º–µ—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω CSRF, –∫–æ—Ç–æ—Ä—ã–π —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –¥–ª—è —ç–∫—à–Ω–∞ –∏ –º–µ—Ç–æ–¥–∞ —ç—Ç–æ–π —Ñ–æ—Ä–º—ã.

```ruby
config.action_controller.per_form_csrf_tokens = true
```

#### –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–µ–Ω–∞

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ HTTP `Origin` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–µ—Ä–µ–Ω —Å –¥–æ–º–µ–Ω–æ–º —Å–∞–π—Ç–∞, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã –æ—Ç CSRF. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ true:

```ruby
config.action_controller.forgery_protection_origin_check = true
```

#### –†–∞–∑—Ä–µ—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–º–µ–Ω–∏ –æ—á–µ—Ä–µ–¥–∏ Action Mailer

–ò–º—è –æ—á–µ—Ä–µ–¥–∏ —Ä–∞—Å—Å—ã–ª—å—â–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `mailers`. –≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –æ–ø—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –æ—á–µ—Ä–µ–¥–∏. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ —Å–≤–æ–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö:

```ruby
config.action_mailer.deliver_later_queue_name = :new_queue_name
```

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –≤–æ –≤—å—é Action Mailer

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [`config.action_mailer.perform_caching`][] –≤ —Å–≤–æ–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –¥–æ–ª–∂–Ω—ã –ª–∏ –≤—å—é Action Mailer –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.

```ruby
config.action_mailer.perform_caching = true
```

[`config.action_mailer.perform_caching`]: /configuring#config-action-mailer-perform-caching

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–≤–æ–¥–∞ `db:structure:dump`

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `schema_search_path` –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL, –º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ö–µ–º–∞. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `:all`, —á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—ã–≥—Ä—É–∑–∫–∏, –∏–ª–∏ `:schema_search_path`, —á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ —Å—Ö–µ–º—ã.

```ruby
config.active_record.dump_schemas = :all
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø—Ü–∏–π SSL, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å HSTS —Å –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ —Å–≤–æ–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å HSTS –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤:

```ruby
config.ssl_options = { hsts: { subdomains: true } }
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Ruby 2.4 –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `to_time`.

```ruby
ActiveSupport.to_time_preserves_timezone = false
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π JSON/JSONB

–í Rails 5.0 –∏–∑–º–µ–Ω–µ–Ω–æ —Ç–æ, –∫–∞–∫ –∞—Ç—Ä–∏–±—É—Ç—ã JSON/JSONB —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –∑–∞–¥–∞—Ç—å —Ç–∏–ø —Å—Ç–æ–ª–±—Ü–∞, —Ä–∞–≤–Ω—ã–π `String`, Active Record –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ `Hash` –∏ –±—É–¥–µ—Ç –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Ç–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä–æ–∫—É. –≠—Ç–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–æ–¥–æ–º, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–º —Å –º–æ–¥–µ–ª—è–º–∏, –∞ —Ç–∞–∫–∂–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–æ–ª–±—Ü–∞ `:default` –≤ `db/schema.rb`. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ –∑–∞–¥–∞–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã, —Ä–∞–≤–Ω—ã–µ `String`, –∞ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `Hash`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ —Å—Ç—Ä–æ–∫—É JSON –∏ –æ–±—Ä–∞—Ç–Ω–æ.

(Upgrading from Rails 4.1 to Rails 4.2) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 4.1 –Ω–∞ Rails 4.2
------------------------------------------------------------------------

### Web Console

–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ `gem "web-console", "~> 2.0"` –≤ –≥—Ä—É–ø–ø—É `:development` —Å–≤–æ–µ–≥–æ `Gemfile` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `bundle install` (–æ–Ω –Ω–µ –≤–∫–ª—é—á–∏—Ç—Å—è –ø—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ Rails). –ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–ª—è—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Ö–µ–ª–ø–µ—Ä—É –∫–æ–Ω—Å–æ–ª–∏ (—Ç.–µ., `<%= console %>`) –≤ –ª—é–±–æ–π –≤—å—é, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤—ã –µ–µ —Ö–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å. –ö–æ–Ω—Å–æ–ª—å —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—à–∏–±–æ–∫ –≤ —Å—Ä–µ–¥–µ development.

### Responders

–ú–µ—Ç–æ–¥ `respond_with` –∏ –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ `respond_to` –±—ã–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã –≤ –≥–µ–º `responders`. –î–ª—è –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ `gem "responders", "~> 2.0"` –≤ —Å–≤–æ–π `Gemfile`. –í—ã–∑–æ–≤—ã `respond_with` –∏ `respond_to` (–Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞) –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≥–µ–º–∞ `responders` –∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º:

```ruby
# app/controllers/users_controller.rb

class UsersController < ApplicationController
  respond_to :html, :json

  def show
    @user = User.find(params[:id])
    respond_with @user
  end
end
```

–ú–µ—Ç–æ–¥ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `respond_to` –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥–µ–º–∞:

```ruby
# app/controllers/users_controller.rb

class UsersController < ApplicationController
  def show
    @user = User.find(params[:id])
    respond_to do |format|
      format.html
      format.json { render json: @user }
    end
  end
end
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º–æ—Ç—Ä–∏—Ç–µ [#16526](https://github.com/rails/rails/pull/16526).

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∫–æ–ª–±—ç–∫–∞—Ö

–í –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç Active Record –∑–∞–º–∞–ª—á–∏–≤–∞–µ—Ç –æ—à–∏–±–∫–∏, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ –≤ –∫–æ–ª–±—ç–∫–∞—Ö `after_rollback` –∏–ª–∏ `after_commit`, –∏ —Ç–æ–ª—å–∫–æ –ø–∏—à–µ—Ç –∏—Ö –≤ –ª–æ–≥–∏. –í —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏ —ç—Ç–∏ –æ—à–∏–±–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –∑–∞–º–∞–ª—á–∏–≤–∞—Ç—å—Å—è. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ—à–∏–±–∫–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º, –∫–∞–∫ –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–ª–±—ç–∫–∞—Ö Active Record.

–ü—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∫–æ–ª–±—ç–∫–∞ `after_rollback` –∏–ª–∏ `after_commit` –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏ –æ–± —ç—Ç–æ–º –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏. –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã, –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —É–±—Ä–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏ —Å –ø–æ–º–æ—â—å—é —Å–ª–µ–¥—É—é—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –≤–∞—à–µ–º `config/application.rb`:

```ruby
config.active_record.raise_in_transactional_callbacks = true
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [#14488](https://github.com/rails/rails/pull/14488) –∏ [#16537](https://github.com/rails/rails/pull/16537).

### –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤

–í Rails 5.0 —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –±—É–¥—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –í –ø—Ä–µ–¥–≤–∫—É—à–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è Rails 4.2 –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –æ–ø—Ü–∏—é `active_support.test_order` –¥–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ —ç—Ç–æ–π –æ–ø—Ü–∏–∏ `:sorted`, –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –±—É–¥—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ —ç—Ç–æ–π –æ–ø—Ü–∏–∏ `:random`.

–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π –æ–ø—Ü–∏–∏, –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–∏. –ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å, –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ—á–∫—É –≤ —Å–≤–æ–µ–π —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ:

```ruby
# config/environments/test.rb
Rails.application.configure do
  config.active_support.test_order = :sorted # –∏–ª–∏ `:random`, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ
end
```

### –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `serialize :metadata, JSON`), –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ `nil` —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –∞—Ç—Ä–∏–±—É—Ç—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç –µ–≥–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ `NULL`, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `nil` —á–µ—Ä–µ–∑ –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"null"` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞ `JSON`).

### –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∞ –≤ Production

–í Rails 5 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∞ –¥–ª—è —Å—Ä–µ–¥—ã production –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `:debug` (—Å `:info`). –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ—á–∫—É –≤ —Å–≤–æ–π `production.rb`:

```ruby
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `:info`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–µ–∫—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏–ª–∏
# ecnfyjdbnt `:debug` –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
config.log_level = :info
```

### `after_bundle` –≤ —à–∞–±–ª–æ–Ω–∞—Ö Rails

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —à–∞–±–ª–æ–Ω Rails, –¥–æ–±–∞–≤–ª—è—é—â–∏–π –≤—Å–µ —Ñ–∞–π–ª—ã –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–∏, —É –Ω–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–Ω—Å—Ç–∞–±—ã, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ Bundler:

```ruby
# template.rb
generate(:scaffold, "person name:string")
route "root to: 'people#index'"
rake("db:migrate")

git :init
git add: "."
git commit: %Q{ -m 'Initial commit' }
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤—ã–∑–æ–≤—ã `git` –≤ –±–ª–æ–∫ `after_bundle`. –û–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –±–∏–Ω—Å—Ç–∞–±—ã.

```ruby
# template.rb
generate(:scaffold, "person name:string")
route "root to: 'people#index'"
rake("db:migrate")

after_bundle do
  git :init
  git add: "."
  git commit: %Q{ -m 'Initial commit' }
end
```

### –°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä HTML –≤ Rails

–ü–æ—è–≤–∏–ª—Å—è –≤—ã–±–æ—Ä –¥–ª—è —Å–∞–Ω–∞—Ü–∏–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ HTML –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è html –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —É—Å—Ç–∞—Ä–µ–ª –≤ –ø–æ–ª—å–∑—É [`Rails HTML Sanitizer`](https://github.com/rails/rails-html-sanitizer).

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥—ã `sanitize`, `sanitize_css`, `strip_tags` –∏ `strip_links` —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ-–Ω–æ–≤–æ–º—É.

–ù–æ–≤—ã–π —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä –≤–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [Loofah](https://github.com/flavorjones/loofah). Loofah, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Nokogiri, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –æ–±–µ—Ä—Ç–∫–æ–π –¥–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ C –∏ Java, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –Ω–∞ –∫–∞–∫–æ–π –≤–µ—Ä—Å–∏–∏ Ruby –æ–Ω–∞ –∑–∞–ø—É—â–µ–Ω–∞.

–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç `sanitize` —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å `Loofah::Scrubber` –¥–ª—è –º–æ—â–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏. [–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ —Å–∫—Ä–∞–±–µ—Ä–æ–≤ —Ç—É—Ç](https://github.com/flavorjones/loofah#loofahscrubber).

–¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –Ω–æ–≤—ã—Ö —Å–∫—Ä–∞–±–µ—Ä–∞: `PermitScrubber` –∏ `TargetScrubber`. –ü–æ–¥—Ä–æ–±–Ω–µ–µ —á–∏—Ç–∞–π—Ç–µ –≤ [readme –≥–µ–º–∞](https://github.com/rails/rails-html-sanitizer).

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è `PermitScrubber` –∏ `TargetScrubber` –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–µ–º, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–±—Ä–æ—à–µ–Ω—ã.

–ï—Å–ª–∏ –≤–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞, –≤–∫–ª—é—á–∏—Ç–µ `rails-deprecated_sanitizer` –≤ —Å–≤–æ–π `Gemfile`:

```ruby
gem "rails-deprecated_sanitizer"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DOM –≤ Rails

[–ú–æ–¥—É–ª—å `TagAssertions`](https://api.rubyonrails.org/v4.1/classes/ActionDispatch/Assertions/TagAssertions.html) (—Å–æ–¥–µ—Ä–∂–∞—â–∏–π –º–µ—Ç–æ–¥—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ `assert_tag`), [—É—Å—Ç–∞—Ä–µ–ª](https://github.com/rails/rails/blob/6061472b8c310158a2a2e8e9a6b81a1aef6b60fe/actionpack/lib/action_dispatch/testing/assertions/dom.rb) –≤ –ø–æ–ª—å–∑—É –º–µ—Ç–æ–¥–æ–≤ `assert_select` –∏–∑ –º–æ–¥—É–ª—è `SelectorAssertions`, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∏–∑–≤–ª–µ—á–µ–Ω –≤ [–≥–µ–º rails-dom-testing](https://github.com/rails/rails-dom-testing).

### –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–í —Ü–µ–ª—è—Ö —É–º–µ–Ω—å—à–µ–Ω–∏—è –∞—Ç–∞–∫ SSL, `form_authenticity_token` —Ç–µ–ø–µ—Ä—å –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫, —á—Ç–æ –æ–Ω –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –¥–µ–º–∞—Å–∫–∏—Ä—É—è—Å—å, –∞ –∑–∞—Ç–µ–º –¥–µ—à–∏—Ñ—Ä—É—è—Å—å. –ö–∞–∫ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ, –ª—é–±—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –Ω–µ-rails —Ñ–æ—Ä–º, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω—ã–π –¥–ª—è —Å–µ—Å—Å–∏–∏ —Ç–æ–∫–µ–Ω CSRF, –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω—è—Ç—å —ç—Ç–æ –≤–æ –≤–Ω–∏–º–∞–Ω–∏–µ.

### Action Mailer

–†–∞–Ω—å—à–µ –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —Ä–∞—Å—Å—ã–ª—å—â–∏–∫–∞ –Ω–∞ –∫–ª–∞—Å—Å–µ —Ä–∞—Å—Å—ã–ª—å—â–∏–∫–∞ –ø—Ä–∏–≤–æ–¥–∏–ª –∫ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ—Ç–æ–¥–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞. –° –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º Active Job –∏ `#deliver_later`, —ç—Ç–æ –±–æ–ª—å—à–µ –Ω–µ —Ç–∞–∫. –í Rails 4.2 –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –±—É–¥—É—Ç –≤—ã–∑–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã `deliver_now` –∏–ª–∏ `deliver_later`. –ù–∞–ø—Ä–∏–º–µ—Ä:

```ruby
class Notifier < ActionMailer::Base
  def notify(user)
    puts "Called"
    mail(to: user.email)
  end
end
```

```ruby
mail = Notifier.notify(user) # Notifier#notify –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ –ø–æ–∫–∞ –µ—â–µ –Ω–µ –≤—ã–∑–≤–∞–Ω
mail = mail.deliver_now      # –ù–∞–ø–∏—à–µ—Ç "Called"
```

–≠—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫–∞–∫–∏–º-–ª–∏–±–æ –∑–Ω–∞—á–∏–º—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞—Å—Å—ã–ª–∞—é—â–∏–µ –º–µ—Ç–æ–¥—ã, –∏ —Ä–∞–Ω—å—à–µ –≤—ã –ø–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–∫—Å–∏—Ä—É—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–ª–µ–¥—É–µ—Ç –æ–±—ä—è–≤–∏—Ç—å –∏—Ö –∫–∞–∫ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞:

```ruby
class Notifier < ActionMailer::Base
  def self.broadcast_notifications(users)
    users.each { |user| Notifier.notify(user) }
  end
end
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

DSL –º–∏–≥—Ä–∞—Ü–∏–π –±—ã–ª —Ä–∞—Å—à–∏—Ä–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≥–µ–º Foreigner, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–µ. –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –≤ Rails —ç—Ç–æ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ Foreigner. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–µ –∫–∞–∂–¥–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Foreigner –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–µ–Ω–æ –µ–≥–æ –∞–Ω–∞–ª–æ–≥–æ–º DSL –º–∏–≥—Ä–∞—Ü–∏–π Rails.

–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–∞—è:

1. —É–±—Ä–∞—Ç—å `gem "foreigner"` –∏–∑ `Gemfile`.
2. –∑–∞–ø—É—Å—Ç–∏—Ç—å `bundle install`.
3. –∑–∞–ø—É—Å—Ç–∏—Ç—å `bin/rake db:schema:dump`.
4. —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `db/schema.rb` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∂–¥–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –æ–ø—Ü–∏—è–º–∏.

(upgrading-from-rails-4-0-to-rails-4-1) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 4.0 –Ω–∞ Rails 4.1
------------------------------------------------------------------------

### –ó–∞—â–∏—Ç–∞ CSRF –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ç–µ–≥–æ–≤ `<script>`

–ò–ª–∏, "–∞-–∞-–∞-–∞, –ø–æ—á–µ–º—É –º–æ–∏ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç!!!?", –∏–ª–∏ "–º–æ–π –≤–∏–¥–∂–µ—Ç `<script>` —Å–ª–æ–º–∞–ª—Å—è!!"

–ó–∞—â–∏—Ç–∞ –æ—Ç –º–µ–∂—Å–∞–π—Ç–æ–≤–æ–π –ø–æ–¥–¥–µ–ª–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ (CSRF) —Å–µ–π—á–∞—Å —Ç–∞–∫–∂–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç GET-–∑–∞–ø—Ä–æ—Å—ã —Å –æ—Ç–∫–ª–∏–∫–∞–º–∏ JavaScript. –≠—Ç–æ –∑–∞–ø—Ä–µ—â–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º —Å–∞–π—Ç–∞–º —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –≤–∞—à–∏ JavaScript —Å –ø–æ–º–æ—â—å—é —Ç–µ–≥–∞ `<script>` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ

```ruby
get :index, format: :js
```

—Ç–µ–ø–µ—Ä—å –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∑–∞—â–∏—Ç—É CSRF. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞

```ruby
xhr :get, :index, format: :js
```

—á—Ç–æ–±—ã —è–≤–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `XmlHttpRequest`.

NOTE: –í–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏ `<script>` —Ç—Ä–∞–∫—Ç—É—é—Ç—Å—è –∫–∞–∫ –º–µ–∂—Å–∞–π—Ç–æ–≤—ã–µ –∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–∞–∫–∂–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è. –ï—Å–ª–∏ –≤—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å JavaScript –≤ —Ç–µ–≥–∞—Ö `<script>`, —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —è–≤–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–∞—â–∏—Ç—É CSRF –¥–ª—è —ç—Ç–æ–≥–æ —ç–∫—à–Ω–∞.

### Spring

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Spring –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞ —Å–≤–æ–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –î–æ–±–∞–≤–∏—Ç—å `gem "spring", group: :development` –≤ —Å–≤–æ–π `Gemfile`.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å spring —Å –ø–æ–º–æ—â—å—é `bundle install`.
3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–Ω—Å—Ç–∞–±—ã Spring —Å –ø–æ–º–æ—â—å—é `bundle exec spring binstub`.

NOTE: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ rake –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ `development`. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –≤ –¥—Ä—É–≥–∏—Ö —Å—Ä–µ–¥–∞—Ö, –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ [Spring README](https://github.com/rails/spring#rake).

### `config/secrets.yml`

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ —Ö—Ä–∞–Ω–µ–Ω–∏—é —Å–µ–∫—Ä–µ—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ `secrets.yml`, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `secrets.yml` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `config` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

    ```yaml
    development:
      secret_key_base:

    test:
      secret_key_base:

    production:
      secret_key_base: <%= ENV["SECRET_KEY_BASE"] %>
    ```

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `secret_key_base` –∏–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ `secret_token.rb`, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã `SECRET_KEY_BASE` –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Rails –≤ production. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `secret_key_base` –∏–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ `secret_token.rb` –≤ `secrets.yml` –≤ —Ä–∞–∑–¥–µ–ª–µ `production`, –∑–∞–º–µ–Ω–∏–≤ `<%= ENV["SECRET_KEY_BASE"] %>`.

3. –£–±—Ä–∞—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä `secret_token.rb`.

4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `rake secret` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ `development` –∏ `test`.

5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ö–µ–ª–ø–µ—Ä–µ

–ï—Å–ª–∏ –≤–∞—à —Ç–µ—Å—Ç–æ–≤—ã–π —Ö–µ–ª–ø–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—ã–∑–æ–≤ `ActiveRecord::Migration.check_pending!`, –µ–≥–æ –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ `require "rails/test_help"`, —Ö–æ—Ç—è –Ω–∞–ª–∏—á–∏–µ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–∏ –≤ –≤–∞—à–∏–º —Ö–µ–ª–ø–µ—Ä–µ –Ω–∏—á–µ–º—É –Ω–µ –Ω–∞–≤—Ä–µ–¥–∏—Ç.

### (cookies-serializer) –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –∫—É–∫–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ Rails 4.1, –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Marshal` –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∫—É–∫–∏ –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É–∫–∏. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ `JSON`, —Ñ–æ—Ä–º–∞—Ç, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```ruby
Rails.application.config.action_dispatch.cookies_serializer = :hybrid
```

–û–Ω –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –º–∏–≥—Ä–∏—Ä—É–µ—Ç –≤–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫—É–∫–∏, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ `Marshal`, –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ `JSON`.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ `:json` –∏–ª–∏ `:hybrid`, —Å–ª–µ–¥—É–µ—Ç –∏–º–µ—Ç—å –≤ –≤–∏–¥—É, —á—Ç–æ –Ω–µ –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã Ruby –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ JSON. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±—ä–µ–∫—Ç—ã `Date` –∏ `Time` –±—É–¥—É—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏, –∏ —É —Ö—ç—à–µ–π –∫–ª—é—á–∏ –±—É–¥—É—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ —Å—Ç—Ä–æ–∫–∏.

```ruby
class CookiesController < ApplicationController
  def set_cookie
    cookies.encrypted[:expiration_date] = Date.tomorrow # => Thu, 20 Mar 2014
    redirect_to action: 'read_cookie'
  end

  def read_cookie
    cookies.encrypted[:expiration_date] # => "2014-03-20"
  end
end
```

–°–æ–≤–µ—Ç—É–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—É–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç—Ä–æ–∫–∏ –∏ —á–∏—Å–ª–∞). –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã. –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —ç—Ç–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –≤ –∫—É–∫–∏, –≤—Å–µ –≤—ã—à–µ—Å–∫–∞–∑–∞–Ω–Ω–æ–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ö—ç—à–∞–º `session` –∏ `flash`.

### –ò–∑–º–µ–Ω–∏–ª–∞—Å—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Flash

–ö–ª—é—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–∏ Flash [–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∏](https://github.com/rails/rails/commit/a668beffd64106a1e1fedb71cc25eaaa11baf0c1). –ö –Ω–∏–º –ø–æ –ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —Å –ø–æ–º–æ—â—å—é —Å–∏–º–≤–æ–ª–∞ –∏–ª–∏ —Å—Ç—Ä–æ–∫–∏. –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ flash –±—É–¥–µ—Ç –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏:

```ruby
flash["string"] = "a string"
flash[:symbol] = "a symbol"

# Rails < 4.1
flash.keys # => ["string", :symbol]

# Rails >= 4.1
flash.keys # => ["string", "symbol"]
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç–µ –∫–ª—é—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π Flash —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏.

### (changes-in-json-handling) –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ JSON

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ JSON –≤ Rails 4.1.

#### –£–±—Ä–∞–Ω MultiJSON

MultiJSON –ø–æ—Ç–µ—Ä—è–ª [—Å–º—ã—Å–ª —Å–≤–æ–µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è](https://github.com/rails/rails/pull/10576) –∏ –±—ã–ª —É–±—Ä–∞–Ω –∏–∑ Rails.

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–µ–π—á–∞—Å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç MultiJSON, —É –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

1. –î–æ–±–∞–≤—å—Ç–µ 'multi_json' –≤ —Å–≤–æ–π `Gemfile`. –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç —á—Ç–æ-–Ω–∏–±—É–¥—å —Å–ª–æ–º–∞—Ç—å –≤ –±—É–¥—É—â–µ–º

2. –£–π—Ç–∏ –æ—Ç MultiJSON –≤ –ø–æ–ª—å–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ `obj.to_json` –∏ `JSON.parse(str)`

WARNING: –ù–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å `MultiJson.dump` –∏ `MultiJson.load` –Ω–∞ `JSON.dump` –∏ `JSON.load`. –≠—Ç–∏ API –≥–µ–º–∞ JSON –æ–∑–Ω–∞—á–∞—é—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ Ruby, –∏, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º, [–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã](https://www.ruby-doc.org/stdlib-2.2.2/libdoc/json/rdoc/JSON.html#method-i-load).

#### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≥–µ–º–æ–º JSON

–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ —É Rails –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –≥–µ–º–æ–º JSON. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JSON.generate` –∏ `JSON.dump` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Rails –º–æ–≥–ª–æ –≤—ã–∑–≤–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏.

Rails 4.1 –∏—Å–ø—Ä–∞–≤–∏–ª —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–≤ —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥–µ—Ä –æ—Ç –≥–µ–º–∞ JSON. API –≥–µ–º–∞ JSON –±—É–¥–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –æ–±—ã—á–Ω–æ, –Ω–æ —É –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º –¥–ª—è Rails. –ù–∞–ø—Ä–∏–º–µ—Ä:

```ruby
class FooBar
  def as_json(options = nil)
    { foo: 'bar' }
  end
end
```

```irb
irb> FooBar.new.to_json
=> "{\"foo\":\"bar\"}"
irb> JSON.generate(FooBar.new, quirks_mode: true)
=> "\"#<FooBar:0x007fa80a481610>\""
```

#### –ù–æ–≤—ã–π –∫–æ–¥–µ—Ä JSON

–ö–æ–¥–µ—Ä JSON –≤ Rails 4.1 –±—ã–ª –ø–µ—Ä–µ–ø–∏—Å–∞–Ω, —á—Ç–æ–±—ã –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ –≥–µ–º–∞ JSON. –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ. –û–¥–Ω–∞–∫–æ, –∫–∞–∫ —á–∞—Å—Ç—å –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è, —Å–ª–µ–¥—É—é—â–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –±—ã–ª–∏ —É–±—Ä–∞–Ω—ã –∏–∑ –∫–æ–¥–µ—Ä–∞:

1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–ª—å—Ü–µ–≤—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ö—É–∫–∞ `encode_json`
3. –û–ø—Ü–∏—è –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ `BigDecimal` –∫–∞–∫ —á–∏—Å–ª–∞, –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–¥–Ω–æ–π –∏–∑ —ç—Ç–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π, –∏—Ö –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å, –¥–æ–±–∞–≤–∏–≤ –≥–µ–º [`activesupport-json_encoder`](https://github.com/rails/activesupport-json_encoder) –≤ —Å–≤–æ–π `Gemfile`.

#### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ JSON –æ–±—ä–µ–∫—Ç–æ–≤ Time

`#as_json` –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏ (`Time`, `DateTime`, `ActiveSupport::TimeWithZone`) —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥. –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥, –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä:

```ruby
ActiveSupport::JSON::Encoding.time_precision = 0
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `return` –≤ –∏–Ω–ª–∞–π–Ω –±–ª–æ–∫–∞—Ö –∫–æ–ª–±—ç–∫–æ–≤

–†–∞–Ω—å—à–µ Rails —Ä–∞–∑—Ä–µ—à–∞–ª –∏–Ω–ª–∞–π–Ω –±–ª–æ–∫–∞–º –∫–æ–ª–±—ç–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `return` —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

```ruby
class ReadOnlyModel < ActiveRecord::Base
  before_save { return false } # –ü–õ–û–•–û
end
```

–≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∏–∫–æ–≥–¥–∞ —è–≤–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–æ—Å—å. –í —Å–≤—è–∑–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–∏ `ActiveSupport::Callbacks`, –æ–Ω–æ –±–æ–ª–µ–µ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ –≤ Rails 4.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è `return` –≤ –∏–Ω–ª–∞–π–Ω –±–ª–æ–∫–µ –∫–æ–ª–±—ç–∫–∞ –≤—ã–∑–æ–≤–µ—Ç `LocalJumpError` –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–ª–±—ç–∫–∞.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `return` –≤ –∏–Ω–ª–∞–π–Ω –±–ª–æ–∫–µ –∫–æ–ª–±—ç–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–æ –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:

```ruby
class ReadOnlyModel < ActiveRecord::Base
  before_save { false } # –•–û–†–û–®–û
end
```

–ö–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω `return`, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —è–≤–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥:

```ruby
class ReadOnlyModel < ActiveRecord::Base
  before_save :before_save_callback # –•–û–†–û–®–û

  private
    def before_save_callback
      false
    end
end
```

–≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É –º–µ—Å—Ç –≤ Rails, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–ª–±—ç–∫–∏, –≤–∫–ª—é—á–∞—è –∫–æ–ª–±—ç–∫–∏ Active Record –∏ Active Model, –∞ —Ç–∞–∫–∂–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ Action
 Controller (—Ç.–µ. `before_action`).

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [—ç—Ç–æ–º pull request](https://github.com/rails/rails/pull/13271).

### –ú–µ—Ç–æ–¥—ã, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö Active Record

Rails 4.1 –≤—ã—á–∏—Å–ª—è–µ—Ç ERB –∫–∞–∂–¥–æ–π —Ñ–∏–∫—Å—Ç—É—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –ø–æ—ç—Ç–æ–º—É –º–µ—Ç–æ–¥—ã —Ö–µ–ª–ø–µ—Ä–∞, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ —Ñ–∏–∫—Å—Ç—É—Ä–µ, –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö.

–ú–µ—Ç–æ–¥—ã —Ö–µ–ª–ø–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –º–æ–¥—É–ª—è—Ö, –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã—Ö –≤ –Ω–æ–≤–æ–º `ActiveRecord::FixtureSet.context_class`, –≤ `test_helper.rb`.

```ruby
module FixtureFileHelpers
  def file_sha(path)
    OpenSSL::Digest::SHA256.hexdigest(File.read(Rails.root.join('test/fixtures', path)))
  end
end
ActiveRecord::FixtureSet.context_class.include FixtureFileHelpers
```

### –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–∫–∞–ª–µ–π I18n

–°–µ–π—á–∞—Å Rails 4.1 —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ–ø—Ü–∏–∏ I18n `enforce_available_locales` `true`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω —É–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –≤—Å–µ –ª–æ–∫–∞–ª–∏, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–≥–æ, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–∫–µ `available_locales`.

–ß—Ç–æ–±—ã —ç—Ç–æ –æ—Ç–∫–ª—é—á–∏—Ç—å (–∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å I18n –ø—Ä–∏–Ω–∏–º–∞—Ç—å *–ª—é–±—ã–µ* –æ–ø—Ü–∏–∏ –ª–æ–∫–∞–ª–∏), –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```ruby
config.i18n.enforce_available_locales = false
```

–û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ —ç—Ç–∞ –æ–ø—Ü–∏—è –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ –º–µ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–æ–∫–∞–ª–∏, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –±—ã–ª–∞ —Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–∞. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞ –æ—Ç–∫–ª—é—á–∞—Ç—å —ç—Ç—É –æ–ø—Ü–∏—é, –µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –≤–µ—Å–æ–º—ã—Ö –ø—Ä–∏—á–∏–Ω —Ç–∞–∫ –¥–µ–ª–∞—Ç—å.

### –ú—É—Ç–∏—Ä—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã (–º—É—Ç–∞—Ç–æ—Ä—ã), –≤—ã–∑—ã–≤–∞–µ–º—ã–µ –Ω–∞ Relation

–£ `Relation` –±–æ–ª—å—à–µ –Ω–µ—Ç –º—É—Ç–∏—Ä—É—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ `#map!` –∏ `#delete_if`. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–π—Ç–µ –≤ –º–∞—Å—Å–∏–≤, –≤—ã–∑—ã–≤–∞—è `#to_a`, –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤.

–≠—Ç–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ—Å—Ç–µ–π –≤ –∫–æ–¥–µ, –≤—ã–∑—ã–≤–∞—é—â–µ–º –º—É—Ç–∏—Ä—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ `Relation`.

```ruby
# –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
Author.where(name: 'Hank Moody').compact!

# –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ç–∞–∫
authors = Author.where(name: 'Hank Moody').to_a
authors.compact!
```

### (changes-on-default-scopes) –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∫–æ—É–ø–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–°–∫–æ—É–ø—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.

–í –ø—Ä–µ–∂–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö, –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –≤ –º–æ–¥–µ–ª–∏ `default_scope`, –æ–Ω –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ –Ω–∞ —Ç–æ –∂–µ –ø–æ–ª–µ. –¢–µ–ø–µ—Ä—å –æ–Ω –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è, –∫–∞–∫ –∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Å–∫–æ—É–ø.

–†–∞–Ω—å—à–µ:

```ruby
class User < ActiveRecord::Base
  default_scope { where state: 'pending' }
  scope :active, -> { where state: 'active' }
  scope :inactive, -> { where state: 'inactive' }
end

User.all
# SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'

User.active
# SELECT "users".* FROM "users" WHERE "users"."state" = 'active'

User.where(state: 'inactive')
# SELECT "users".* FROM "users" WHERE "users"."state" = 'inactive'
```

–ü–æ—Å–ª–µ:

```ruby
class User < ActiveRecord::Base
  default_scope { where state: 'pending' }
  scope :active, -> { where state: 'active' }
  scope :inactive, -> { where state: 'inactive' }
end

User.all
# SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'

User.active
# SELECT "users".* FROM "users" WHERE "users"."state" = 'pending' AND "users"."state" = 'active'

User.where(state: 'inactive')
# SELECT "users".* FROM "users" WHERE "users"."state" = 'pending' AND "users"."state" = 'inactive'
```

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —è–≤–Ω–æ —É–±—Ä–∞—Ç—å —É—Å–ª–æ–≤–∏–µ `default_scope` —Å –ø–æ–º–æ—â—å—é `unscoped`, `unscope`, `rewhere` –∏–ª–∏ `except`.

```ruby
class User < ActiveRecord::Base
  default_scope { where state: 'pending' }
  scope :active, -> { unscope(where: :state).where(state: 'active') }
  scope :inactive, -> { rewhere state: 'inactive' }
end

User.all
# SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'

User.active
# SELECT "users".* FROM "users" WHERE "users"."state" = 'active'

User.inactive
# SELECT "users".* FROM "users" WHERE "users"."state" = 'inactive'
```

### (rendering-content-from-string) –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ —Å—Ç—Ä–æ–∫–∏

Rails 4.1 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–ø—Ü–∏–∏ `:plain`, `:html` –∏ `:body` –¥–ª—è `render`. –≠—Ç–∏ –æ–ø—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å —è–≤–ª—è—é—Ç—Å—è –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ —Å—Ç—Ä–æ–∫–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ, —Ç–∞–∫ –∫–∞–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–æ–π —Ç–∏–ø —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–æ—Å–ª–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–∫–ª–∏–∫–∞.

* `render :plain` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–∏–ø —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `text/plain`
* `render :html` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–∏–ø —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `text/html`
* `render :body` *–Ω–µ* —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∏–ø–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.

–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –∫–∞–∫–æ–π-–ª–∏–±–æ —Ä–∞–∑–º–µ—Ç–∫–∏ –≤ —Ç–µ–ª–µ –æ—Ç–∫–ª–∏–∫–∞, —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `render :plain`, —Ç–∞–∫ –∫–∞–∫ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±—É–¥–µ—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∞—à–µ–≥–æ –æ—Ç–∫–ª–∏–∫–∞.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `render :text` –±—É–¥–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–∏–Ω–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ–ø—Ü–∏–∏ `:plain`, `:html` –∏ `:body`. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `render :text` –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ä–∏—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ç–∞–∫ –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è –∫–∞–∫ `text/html`.

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö JSON –∏ hstore –≤ PostgreSQL

Rails 4.1 —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å—Ç–æ–ª–±—Ü—ã `json` –∏ `hstore` —Å Ruby `Hash` —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏. –í –ø—Ä–µ–∂–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `HashWithIndifferentAccess`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–æ—Å—Ç—É–ø –ø–æ —Å–∏–º–≤–æ–ª—É –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –≠—Ç–æ —Ç–∞–∫–∂–µ –∫–∞—Å–∞–µ—Ç—Å—è `store_accessors`, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ —Å—Ç–æ–ª–±—Ü–∞—Ö `json` –∏–ª–∏ `hstore`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏.

### –Ø–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ –¥–ª—è `ActiveSupport::Callbacks`

Rails 4.1 —Ç–µ–ø–µ—Ä—å –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω —è–≤–Ω—ã–π –±–ª–æ–∫ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `ActiveSupport::Callbacks.set_callback`. –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –∏–∑ `ActiveSupport::Callbacks`, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Ä–µ–ª–∏–∑–∞ 4.1.

```ruby
# –†–∞–Ω—å—à–µ –≤ Rails 4.0
set_callback :save, :around, ->(r, &block) { stuff; result = block.call; stuff }

# –¢–µ–ø–µ—Ä—å –≤ Rails 4.1
set_callback :save, :around, ->(r, block) { stuff; result = block.call; stuff }
```

(upgrading-from-rails-3-2-to-rails-4-0) –ê–ø–≥—Ä–µ–π–¥ —Å Rails 3.2 –Ω–∞ Rails 4.0
------------------------------------------------------------------------

–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è Rails –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–µ–π—á–∞—Å —Å—Ç–∞—Ä—à–µ —á–µ–º 3.2.x, —Å–ª–µ–¥—É–µ—Ç —Å–ø–µ—Ä–≤–∞ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞–ø–≥—Ä–µ–π–¥ –Ω–∞ Rails 3.2, –ø–µ—Ä–µ–¥ –ø–æ–ø—ã—Ç–∫–æ–π –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –¥–æ Rails 4.0.

–°–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Rails 4.0.

### HTTP PATCH

Rails 4 —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PATCH` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ HTTP –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –∫–æ–≥–¥–∞ –≤ `config/routes.rb` –æ–±—ä—è–≤–ª–µ–Ω RESTful-—Ä–µ—Å—É—Ä—Å. –≠–∫—à–Ω `update` –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∏ –∑–∞–ø—Ä–æ—Å—ã `PUT` —Ç–∞–∫–∂–µ –±—É–¥—É—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –∫ —ç–∫—à–Ω—É `update`. –ü–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ RESTful-–º–∞—Ä—à—Ä—É—Ç—ã, –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```ruby
resources :users
```

```erb
<%= form_for @user do |f| %>
```

```ruby
class UsersController < ApplicationController
  def update
    # No change needed; PATCH will be preferred, and PUT will still work.
  end
end
```

–û–¥–Ω–∞–∫–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `form_for` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞ –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–æ–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–∞ `PUT` HTTP:

```ruby
resources :users do
  put :update_name, on: :member
end
```

```erb
<%= form_for [ :update_name, @user ] do |f| %>
```

```ruby
class UsersController < ApplicationController
  def update_name
    # –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ; form_for –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Ä—à—Ä—É—Ç PATCH.
  end
end
```

–ï—Å–ª–∏ —ç–∫—à–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º API, –∏ –º–æ–∂–Ω–æ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –∏–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ HTTP, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `patch` –≤–º–µ—Å—Ç–æ `put`:

```ruby
resources :users do
  patch :update_name, on: :member
end
```

–ó–∞–ø—Ä–æ—Å—ã `PUT` –∫ `/users/:id` –≤ Rails 4 –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫ `update`, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ. –ü–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ –≤–∞—à–µ API –ø–æ–ª—É—á–∏—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ PUT-–∑–∞–ø—Ä–æ—Å—ã, –æ–Ω–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –†–æ—É—Ç–µ—Ä —Ç–∞–∫–∂–µ –Ω–∞–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å—ã `PATCH` –∫ `/users/:id` –≤ —ç–∫—à–Ω `update`.

–ï—Å–ª–∏ —ç–∫—à–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º API, –∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–µ—Ç–æ–¥ HTTP, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞ `PUT`:

```erb
<%= form_for [ :update_name, @user ], method: :put do |f| %>
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ PATCH, –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ, —Å–º–æ—Ç—Ä–∏—Ç–µ [—ç—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏—é](https://weblog.rubyonrails.org/2012/2/26/edge-rails-patch-is-the-new-primary-http-method-for-updates/) –≤ –±–ª–æ–≥–µ Rails.

#### –ó–∞–º–µ—Ç–∫–∞ –æ —Ç–∏–ø–∞—Ö –º–µ–¥–∏–∞

–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –º–µ—Ç–æ–¥–∞ `PATCH` [–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ —Å `PATCH` –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∏–ø –º–µ–¥–∏–∞ 'diff' ](http://www.rfc-editor.org/errata_search.php?rfc=5789). –û–¥–∏–Ω –∏–∑ —Ç–∞–∫–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ [JSON Patch](https://tools.ietf.org/html/rfc6902). –•–æ—Ç—è Rails –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON Patch, —Ç–∞–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å:

```ruby
# –≤ –≤–∞—à–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
def update
  respond_to do |format|
    format.json do
      # –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      @article.update params[:post]
    end

    format.json_patch do
      # –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–æ–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    end
  end
end
```

```ruby
# config/initializers/json_patch.rb
Mime::Type.register 'application/json-patch+json', :json_patch
```

–¢–∞–∫ –∫–∞–∫ JSON Patch —Ç–æ–ª—å–∫–æ –Ω–µ–¥–∞–≤–Ω–æ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ RFC, –ø–æ–∫–∞ –µ—â–µ –Ω–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ Ruby. –û–¥–∏–Ω –∏–∑ –∏–º–µ—é—â–∏—Ö—Å—è –≥–µ–º–æ–≤ [hana](https://github.com/tenderlove/hana) –æ—Ç Aaron Patterson, –Ω–æ –≤ –Ω–µ–º –µ—â–µ –Ω–µ—Ç –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### Gemfile

Rails 4.0 —É–±—Ä–∞–ª –≥—Ä—É–ø–ø—É `assets` –∏–∑ `Gemfile`. –í–∞–º –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ—á–∫—É –∏–∑ `Gemfile` –ø–µ—Ä–µ–¥ –∞–ø–≥—Ä–µ–π–¥–æ–º. –¢–∞–∫–∂–µ —Å–ª–µ–¥—É–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`config/application.rb`):

```ruby
# Require the gems listed in Gemfile, including any gems
# you've limited to :test, :development, or :production.
Bundler.require(*Rails.groups)
```

### vendor/plugins

Rails 4.0 –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø–ª–∞–≥–∏–Ω–æ–≤ –∏–∑ `vendor/plugins`. –°–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ª—é–±—ã–µ –ø–ª–∞–≥–∏–Ω—ã, –∏–∑–≤–ª–µ–∫–∞—è –∏—Ö –≤ –≥–µ–º—ã –∏ –ø–æ–º–µ—â–∞—è –∏—Ö –≤ `Gemfile`. –ï—Å–ª–∏ —Ä–µ—à–∞–µ—Ç–µ –Ω–µ –¥–µ–ª–∞—Ç—å –≥–µ–º—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏—Ö, —Å–∫–∞–∂–µ–º, –≤ `lib/my_plugin/*` –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –≤ `config/initializers/my_plugin.rb`.

### Active Record

* Rails 4.0 —É–±—Ä–∞–ª identity map –∏–∑ Active Record, –∏–∑-–∑–∞ [–Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Å–æ —Å–≤—è–∑—è–º–∏](https://github.com/rails/rails/commit/302c912bf6bcd0fa200d964ec2dc4a44abe328a6). –ï—Å–ª–∏ –≤—ã –≤—Ä—É—á–Ω—É—é –≤–∫–ª—é—á–∞–ª–∏ —ç—Ç–æ –≤ —Å–≤–æ–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É, —Ç–∞–∫ –∫–∞–∫ –æ—Ç –Ω–µ–µ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∞: `config.active_record.identity_map`.

* –ú–µ—Ç–æ–¥ `delete` –≤ —Å–≤—è–∑—è—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã `Integer` –∏–ª–∏ `String` –≤ –∫–∞—á–µ—Å—Ç–≤–µ id –∑–∞–ø–∏—Å–µ–π, –∫—Ä–æ–º–µ —Å–∞–º–∏—Ö –∑–∞–ø–∏—Å–µ–π, —Ç–∞–∫ –∂–µ, –∫–∞–∫ –¥–µ–ª–∞–µ—Ç –º–µ—Ç–æ–¥ `destroy`. –†–∞–Ω—å—à–µ –æ–Ω –≤—ã–∑—ã–≤–∞–ª `ActiveRecord::AssociationTypeMismatch` –¥–ª—è —Ç–∞–∫–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ù–∞—á–∏–Ω–∞—è —Å Rails 4.0, `delete` –ø—ã—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º id, –¥–æ –∏—Ö —É–¥–∞–ª–µ–Ω–∏—è.

* –í Rails 4.0, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ–ª–±–µ—Ü –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –Ω–∏–º –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã ‚Äì –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã.

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª `serialized_attributes` –∏ `attr_readonly` –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–∞–º–∏ –∫–ª–∞—Å—Å–∞. –ù–µ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —É—Å—Ç–∞—Ä–µ–ª–∏. –°–ª–µ–¥—É–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –∏—Ö –Ω–∞ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞, —Ç.–µ. `self.serialized_attributes` –Ω–∞ `self.class.serialized_attributes`.

* –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ `nil` —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –∞—Ç—Ä–∏–±—É—Ç—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç –µ–≥–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ `NULL`, –≤–º–µ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è `nil` —á–µ—Ä–µ–∑ YAML (`"--- \n...\n"`).

* Rails 4.0 —É–±—Ä–∞–ª –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å `attr_accessible` –∏ `attr_protected` –≤ –ø–æ–ª—å–∑—É. –î–ª—è –±–æ–ª–µ–µ –≥–ª–∞–¥–∫–æ–≥–æ (smooth) –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–ø–≥—Ä–µ–π–¥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [–≥–µ–º Protected Attributes](https://github.com/rails/protected_attributes).

* –ï—Å–ª–∏ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Protected Attributes, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –æ–ø—Ü–∏–∏, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ —ç—Ç–æ–º—É –≥–µ–º—É, —Ç–∞–∫–∏–µ –∫–∞–∫ `whitelist_attributes` –∏–ª–∏ `mass_assignment_sanitizer`.

* Rails 4.0 —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã —Å–∫–æ—É–ø—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–π –æ–±—ä–µ–∫—Ç, —Ç–∞–∫–æ–π –∫–∞–∫ Proc –∏–ª–∏ lambda:

    ```ruby
    scope :active, where(active: true)

    # —Å—Ç–∞–Ω–µ—Ç
    scope :active, -> { where active: true }
    ```

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª–∏ `ActiveRecord::Fixtures` –≤ –ø–æ–ª—å–∑—É `ActiveRecord::FixtureSet`.

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActiveRecord::TestCase` –≤ –ø–æ–ª—å–∑—É `ActiveSupport::TestCase`.

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª API –ø–æ–∏—Å–∫–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ —Ö—ç—à–µ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–Ω—å—à–µ –ø—Ä–∏–Ω–∏–º–∞–ª–∏ "finder options", –±–æ–ª—å—à–µ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—é—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä, `Book.find(:all, conditions: { name: '1984' })` —É—Å—Ç–∞—Ä–µ–ª –≤ –ø–æ–ª—å–∑—É `Book.where(name: '1984')`

* –í—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã, –∫—Ä–æ–º–µ `find_by_...` and `find_by_...!`, —É—Å—Ç–∞—Ä–µ–ª–∏. –í–æ—Ç –∫–∞–∫ –º–æ–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

      * `find_all_by_...`           —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `where(...)`.
      * `find_last_by_...`          —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `where(...).last`.
      * `scoped_by_...`             —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `where(...)`.
      * `find_or_initialize_by_...` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `find_or_initialize_by(...)`.
      * `find_or_create_by_...`     —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `find_or_create_by(...)`.

* –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ `where(...)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç relation, –∞ –Ω–µ –º–∞—Å—Å–∏–≤, –∫–∞–∫ —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–∏—Å–∫–∞. –ï—Å–ª–∏ –≤—ã –æ–∂–∏–¥–∞–µ—Ç–µ –º–∞—Å—Å–∏–≤, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `where(...).to_a`.

* –≠—Ç–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π SQL —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π.

* –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–∏—Å–∫–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [–≥–µ–º activerecord-deprecated_finders](https://github.com/rails/activerecord-deprecated_finders).

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–≤—è–∑–µ–π `has_and_belongs_to_many`, —É–¥–∞–ª—è—è –æ–±—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å –∏–∑ –∏–º–µ–Ω–∏ –≤—Ç–æ—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã. –õ—é–±–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–≤—è–∑—å `has_and_belongs_to_many` –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ —Å –æ–±—â–∏–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–∞ –æ–ø—Ü–∏—è `join_table`. –ù–∞–ø—Ä–∏–º–µ—Ä:

    ```ruby
    class CatalogCategory < ActiveRecord::Base
      has_and_belongs_to_many :catalog_products, join_table: 'catalog_categories_catalog_products'
    end

    class CatalogProduct < ActiveRecord::Base
      has_and_belongs_to_many :catalog_categories, join_table: 'catalog_categories_catalog_products'
    end
    ```

* –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ –ø—Ä–µ—Ñ–∏–∫—Å —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–æ –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω, –ø–æ—ç—Ç–æ–º—É —Å–≤—è–∑–∏ –º–µ–∂–¥—É `Catalog::Category` –∏ `Catalog::Product` –∏–ª–∏ `Catalog::Category` –∏ `CatalogProduct` —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å.


### Active Resource

Rails 4.0 –∏–∑–≤–ª–µ–∫ Active Resource –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–µ–º. –ï—Å–ª–∏ –≤–∞–º –≤—Å–µ –µ—â–µ –Ω—É–∂–Ω–∞ —ç—Ç–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å, –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å [–≥–µ–º Active Resource](https://github.com/rails/activeresource) –≤ —Å–≤–æ–µ–º `Gemfile`.

### Active Model

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª —Ç–æ, –∫–∞–∫ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ —Å –ø–æ–º–æ—â—å—é `ActiveModel::Validations::ConfirmationValidator`. –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –æ—à–∏–±–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∞ –∫ `:#{attribute}_confirmation` –≤–º–µ—Å—Ç–æ `attribute`.

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è `ActiveModel::Serializers::JSON.include_root_in_json` –Ω–∞ `false`. –¢–µ–ø–µ—Ä—å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã Active Model –∏ –æ–±—ä–µ–∫—Ç—ã Active Record –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –æ–ø—Ü–∏—é –≤ —Ñ–∞–π–ª–µ `config/initializers/wrap_parameters.rb`:

    ```ruby
    # Disable root element in JSON by default.
    # ActiveSupport.on_load(:active_record) do
    #   self.include_root_in_json = false
    # end
    ```

### Action Pack

* Rails 4.0 –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª `ActiveSupport::KeyGenerator`, –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ, –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∫—É–∫–∏ (—Å—Ä–µ–¥–∏ –ø—Ä–æ—á–µ–≥–æ). –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫—É–∫–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é Rails 3.x, –±—É–¥—É—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É—Ç—ã, –µ—Å–ª–∏ –≤—ã –æ—Å—Ç–∞–≤–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `secret_token` –∏ –¥–æ–±–∞–≤–∏—Ç–µ –Ω–æ–≤—ã–π `secret_key_base`.

    ```ruby
    # config/initializers/secret_token.rb
    Myapp::Application.config.secret_token = 'existing secret token'
    Myapp::Application.config.secret_key_base = 'new secret key base'
    ```

    –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ –≤—ã –¥–æ–ª–∂–Ω—ã –æ–±–æ–∂–¥–∞—Ç—å —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `secret_key_base`, –ø–æ–∫–∞ 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –ø–µ—Ä–µ–π–¥–µ—Ç –Ω–∞ Rails 4.x, –∏ –≤—ã —Ç–æ—á–Ω–æ –Ω–µ –±—É–¥–µ—Ç–µ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ Rails 3.x. –≠—Ç–æ —Ç–∞–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫—É–∫–∏, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ–≥–æ `secret_key_base` –≤ Rails 4.x, –æ–±—Ä–∞—Ç–Ω–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å Rails 3.x. –ú–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `secret_token`, –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–æ–≤—ã–π `secret_key_base` –∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –ø–æ–∫–∞ –≤—ã –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –∞–ø–≥—Ä–µ–π–¥ –∑–∞–≤–µ—Ä—à–µ–Ω.

    –ï—Å–ª–∏ –≤—ã –ø–æ–ª–∞–≥–∞–µ—Ç–µ—Å—å –Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ JavaScript —á–∏—Ç–∞—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫—É–∫–∏ —Å–µ—Å—Å–∏–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Rails (–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫—É–∫–∏ –≤ —Ü–µ–ª–æ–º), –≤–∞–º –Ω–µ —Å–ª–µ–¥—É–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `secret_key_base`, –ø–æ–∫–∞ –≤—ã –Ω–µ –∏–∑–±–∞–≤–∏—Ç–µ—Å—å –æ—Ç —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã.

* Rails 4.0 —à–∏—Ñ—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –∫—É–∫–∏ —Å–µ—Å—Å–∏–∏, –µ—Å–ª–∏ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `secret_key_base`. Rails 3.x –ø–æ–¥–ø–∏—Å—ã–≤–∞–ª, –Ω–æ –Ω–µ —à–∏—Ñ—Ä–æ–≤–∞–ª —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –∫—É–∫–∏ —Å–µ—Å—Å–∏–∏. –ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫—É–∫–∏ "–±–µ–∑–æ–ø–∞—Å–Ω—ã", —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –æ–Ω–∏ –±—ã–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –≤–∑–ª–æ–º–∞. –û–¥–Ω–∞–∫–æ, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —ç—Ç—É –∑–∞–±–æ—Ç—É –±–µ–∑ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

    –ü–æ–¥—Ä–æ–±–Ω–µ–µ —á–∏—Ç–∞–π—Ç–µ –≤ [Pull Request #9978](https://github.com/rails/rails/pull/9978) –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫—É–∫–∏ —Å–µ—Å—Å–∏–∏.

* Rails 4.0 —É–±—Ä–∞–ª –æ–ø—Ü–∏—é `ActionController::Base.asset_path`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (assets pipeline).

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª–∞ –æ–ø—Ü–∏—è `ActionController::Base.page_cache_extension`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–æ –Ω–µ–µ `ActionController::Base.default_static_extension`.

* Rails 4.0 —É–±—Ä–∞–ª –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —ç–∫—à–Ω–æ–≤ –∏–∑ Action Pack. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≥–µ–º `actionpack-action_caching` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `caches_action` –∏ `actionpack-page_caching` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `caches_page` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

* Rails 4.0 —É–±—Ä–∞–ª –ø–∞—Ä—Å–µ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ XML. –°–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≥–µ–º `actionpack-xml_parser`, –µ—Å–ª–∏ –≤–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —ç—Ç–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å.

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª –Ω–∞–±–æ—Ä –ø–æ–∏—Å–∫–∞ `layout` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –ø–æ–º–æ—â—å—é —Å–∏–º–≤–æ–ª–æ–≤ –∏–ª–∏ –ø—Ä–æ–∫–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö nil. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ "–±–µ–∑ –º–∞–∫–µ—Ç–∞", –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ false –≤–º–µ—Å—Ç–æ nil.

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª –∫–ª–∏–µ–Ω—Ç memcached –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å `memcache-client` –Ω–∞ `dalli`. –ß—Ç–æ–±—ã –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞–ø–≥—Ä–µ–π–¥, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ `gem 'dalli'` –≤ —Å–≤–æ–π `Gemfile`.

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª–∏ –º–µ—Ç–æ–¥—ã `dom_id` –∏ `dom_class` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö (–æ–Ω–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –≤–æ –≤—å—é). –í–∞–º —Å–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å `ActionView::RecordIdentifier` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö, —Ç—Ä–µ–±—É—é—â–∏—Ö —ç—Ç—É –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å.

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª–∞ –æ–ø—Ü–∏—è `:confirm` –¥–ª—è —Ö–µ–ª–ø–µ—Ä–∞ `link_to`. –í–º–µ—Å—Ç–æ –Ω–µ–µ —Å–ª–µ–¥—É–µ—Ç –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç data (—Ç.–µ. `data: { confirm: 'Are you sure?' }`). –≠—Ç–æ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ —Ç–∞–∫–∂–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç —Ö–µ–ª–ø–µ—Ä—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–æ–º (—Ç–∞–∫–∏–µ –∫–∞–∫ `link_to_if` –∏–ª–∏ `link_to_unless`).

* Rails 4.0 –∏–∑–º–µ–Ω–∏–ª —Ä–∞–±–æ—Ç—É `assert_generates`, `assert_recognizes` –∏ `assert_routing`. –¢–µ–ø–µ—Ä—å –≤—Å–µ —ç—Ç–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤—ã–∑—ã–≤–∞—é—Ç `Assertion` –≤–º–µ—Å—Ç–æ `ActionController::RoutingError`.

* Rails 4.0 –≤—ã–∑—ã–≤–∞–µ—Ç `ArgumentError`, –µ—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ–ª–ª–∏–∑–∏–∏ –≤ –∏–º–µ–Ω–∞—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–æ –∫–∞–∫ —è–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏, –ª–∏–±–æ –º–µ—Ç–æ–¥–æ–º `resources`. –í–æ—Ç –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç –∫–æ–ª–ª–∏–∑–∏—é –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –∏–º–µ–Ω–µ–º `example_path`:

    ```ruby
    get 'one' => 'test#example', as: :example
    get 'two' => 'test#example', as: :example
    ```

    ```ruby
    resources :examples
    get 'clashing/:id' => 'test#example', as: :example
    ```

    –í –ø–µ—Ä–≤–æ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∏–∑–±–µ–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤. –í–æ –≤—Ç–æ—Ä–æ–º —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ü–∏–∏ `only` –∏–ª–∏ `except`, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–æ–º `resources`, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã, –æ —á–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–æ –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ [–†–æ—É—Ç–∏–Ω–≥ –≤ Rails](/routing#restricting-the-routes-created).

* Rails 4.0 —Ç–∞–∫–∂–µ –∏–∑–º–µ–Ω–∏–ª —Å–ø–æ—Å–æ–± –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å —Å–∏–º–≤–æ–ª–∞–º–∏ unicode. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å —Å–∏–º–≤–æ–ª—ã unicode character. –ï—Å–ª–∏ –≤—ã —É–∂–µ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç–µ —Ç–∞–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã, –∏—Ö –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä:

    ```ruby
    get Rack::Utils.escape('„Åì„Çì„Å´„Å°„ÅØ'), controller: 'welcome', action: 'index'
    ```

    —Å—Ç–∞–Ω–µ—Ç

    ```ruby
    get '„Åì„Çì„Å´„Å°„ÅØ', controller: 'welcome', action: 'index'
    ```

* Rails 4.0 —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –º–∞—Ä—à—Ä—É—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `match` —É–∫–∞–∑—ã–≤–∞–ª–∏ –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞. –ù–∞–ø—Ä–∏–º–µ—Ä:

    ```ruby
    # Rails 3.x
    match '/' => 'root#index'

    # —Å—Ç–∞–Ω–µ—Ç
    match '/' => 'root#index', via: :get

    # –∏–ª–∏
    get '/' => 'root#index'
  ```

* –í Rails 4.0 —É–±—Ä–∞–Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ `ActionDispatch::BestStandardsSupport`, `<!DOCTYPE html>` —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å https://msdn.microsoft.com/en-us/library/jj676915(v=vs.85).aspx, –∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ ChromeFrame –±—ã–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ `config.action_dispatch.default_headers`.

    –ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –≤—ã —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã —É–±—Ä–∞—Ç—å –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏–∑ –∫–æ–¥–∞ —Å–≤–æ–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:

    ```ruby
    # –í—ã–∑–æ–≤–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    config.middleware.insert_before(Rack::Lock, ActionDispatch::BestStandardsSupport)
    ```

    –¢–∞–∫–∂–µ –Ω–∞–π–¥–∏—Ç–µ –≤ —Å–≤–æ–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å—Ä–µ–¥ `config.action_dispatch.best_standards_support`, –∏ —É–±–µ—Ä–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ—á–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å.

* Rails 4.0 –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ `config.action_dispatch.default_headers`. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–ª–µ–¥—É—é—â–∏–µ:

    ```ruby
    config.action_dispatch.default_headers = {
      'X-Frame-Options' => 'SAMEORIGIN',
      'X-XSS-Protection' => '1; mode=block'
    }
    ```

    –û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ –µ—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –≤ `<frame>` –∏–ª–∏ `<iframe>`, —Ç–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `X-Frame-Options` –≤ `ALLOW-FROM ...` –∏–ª–∏ `ALLOWALL`.

* –í Rails 4.0 –ø—Ä–∏ –ø—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∞—Å—Å–µ—Ç–æ–≤ –Ω–µ –±—É–¥—É—Ç –±–æ–ª—å—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–µ-JS/CSS –∞—Å—Å–µ—Ç—ã –∏–∑ `vendor/assets` –∏ `lib/assets`. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ Rails –∏ engine-–æ–≤ –¥–æ–ª–∂–Ω—ã –ø–æ–º–µ—Å—Ç–∏—Ç—å —ç—Ç–∏ –∞—Å—Å–µ—Ç—ã –≤ `app/assets` –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å [`config.assets.precompile`][].

* –í Rails 4.0 –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `ActionController::UnknownFormat`, –∫–æ–≥–¥–∞ —ç–∫—à–Ω –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –æ—Ç–∫–ª–∏–∫–∞—è—Å—å —Å –ø–æ–º–æ—â—å—é 406 Not Acceptable, –Ω–æ —Ç–µ–ø–µ—Ä—å —ç—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å. –í Rails 3 –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è 406 Not Acceptable. –ë–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

* –í Rails 4.0 –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `ActionDispatch::ParamsParser::ParseError`, –∫–æ–≥–¥–∞ `ParamsParser` –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞. –í–∞–º –Ω—É–∂–Ω–æ –ª–æ–≤–∏—Ç—å —ç—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –≤–º–µ—Å—Ç–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ `MultiJson::DecodeError`, –Ω–∞–ø—Ä–∏–º–µ—Ä.

* –í Rails 4.0 `SCRIPT_NAME` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ engine –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –Ω–∞—Ö–æ–¥—è—â–µ–º—Å—è –Ω–∞ –ø—Ä–µ—Ñ–∏–∫—Å–µ URL. –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `default_url_options[:script_name]`, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ URL.

* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::Integration` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::Integration`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::IntegrationTest` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::IntegrationTest`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::PerformanceTest` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::PerformanceTest`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::AbstractRequest` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::Request`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::Request` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::Request`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::AbstractResponse` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::Response`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::Response` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::Response`.
* –í Rails 4.0 —É—Å—Ç–∞—Ä–µ–ª `ActionController::Routing` –≤ –ø–æ–ª—å–∑—É `ActionDispatch::Routing`.

[`config.assets.precompile`]: /configuring#config-assets-precompile

### Active Support

Rails 4.0 —É–±—Ä–∞–ª –ø—Å–µ–≤–¥–æ–Ω–∏–º `j` –¥–ª—è `ERB::Util#json_escape`, —Ç–∞–∫ –∫–∞–∫ `j` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `ActionView::Helpers::JavaScriptHelper#escape_javascript`.

#### Cache

–ú–µ—Ç–æ–¥ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª—Å—è –º–µ–∂–¥—É Rails 3.x –∏ 4.0. –í—ã –¥–æ–ª–∂–Ω—ã [–∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω](/caching-with-rails#activesupport-cache-store) –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—Ç—å —Å —Ö–æ–ª–æ–¥–Ω—ã–º –∫—ç—à–µ–º.

### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–µ–ª–ø–µ—Ä–æ–≤

–í Rails 4.0 –∏–∑–º–µ–Ω–∏–ª—Å—è –ø–æ—Ä—è–¥–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å —Ö–µ–ª–ø–µ—Ä—ã –∏–∑ –±–æ–ª–µ–µ —á–µ–º –æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –†–∞–Ω–µ–µ –æ–Ω–∏ —Å–æ–±–∏—Ä–∞–ª–∏—Å—å, –∞ –∑–∞—Ç–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. –ü–æ—Å–ª–µ –∞–ø–≥—Ä–µ–π–¥–∞ –Ω–∞ Rails 4.0, —Ö–µ–ª–ø–µ—Ä—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –±—É–¥—É—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–∞–∂–¥–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ï—Å–ª–∏ –≤—ã —è–≤–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `helpers_path`, –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–ø–æ—Å–æ–± –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–µ–ª–ø–µ—Ä–æ–≤ –∏–∑ engine-–æ–≤. –ï—Å–ª–∏ –≤—ã –ø–æ–ª–∞–≥–∞–µ—Ç–µ—Å—å –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏, —Å–ª–µ–¥—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Å–ª–µ –∞–ø–≥—Ä–µ–π–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è engine, –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `config.railties_order=`.

### Active Record Observer –∏ Action Controller Sweeper

`ActiveRecord::Observer` –∏ `ActionController::Caching::Sweeper` –±—ã–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã –≤ –≥–µ–º `rails-observers`. –°–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≥–µ–º `rails-observers`, –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω—ã —ç—Ç–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏.

### sprockets-rails

*   `assets:precompile:primary` –∏ `assets:precompile:all` –±—ã–ª–∏ —É–±—Ä–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–æ –Ω–∏—Ö `assets:precompile`.
*   –û–ø—Ü–∏—è `config.assets.compress` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ [`config.assets.js_compressor`][], –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫:

    ```ruby
    config.assets.js_compressor = :uglifier
    ```

[`config.assets.js_compressor`]: /configuring#config-assets-js-compressor

### sass-rails

*   `asset_url` —Å –¥–≤—É–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —É—Å—Ç–∞—Ä–µ–ª. –ù–∞–ø—Ä–∏–º–µ—Ä: `asset-url("rails.png", image)` —Å—Ç–∞–ª `asset-url("rails.png")`

–ê–ø–≥—Ä–µ–π–¥ —Å Rails 3.1 –Ω–∞ Rails 3.2
--------------------------------

–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è Rails –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–µ–π—á–∞—Å —Å—Ç–∞—Ä—à–µ —á–µ–º 3.1.x, —Å–ª–µ–¥—É–µ—Ç —Å–ø–µ—Ä–≤–∞ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞–ø–≥—Ä–µ–π–¥ –Ω–∞ Rails 3.1, –ø–µ—Ä–µ–¥ –ø–æ–ø—ã—Ç–∫–æ–π –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –¥–æ Rails 3.2.

–°–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é 3.2.x Rails.

### Gemfile

–°–¥–µ–ª–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–≤–æ–µ–º `Gemfile`.

```ruby
gem "rails", "3.2.21"

group :assets do
  gem "sass-rails",   "~> 3.2.6"
  gem "coffee-rails", "~> 3.2.2"
  gem "uglifier",     ">= 1.0.3"
end
```

### config/environments/development.rb

–ò–º–µ–µ—Ç—Å—è —Ä—è–¥ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ä–µ–¥–µ development:

```ruby
# Raise exception on mass assignment protection for Active Record models
config.active_record.mass_assignment_sanitizer = :strict

# Log the query plan for queries taking more than this (works
# with SQLite, MySQL, and PostgreSQL)
config.active_record.auto_explain_threshold_in_seconds = 0.5
```

### config/environments/test.rb

–¢–∞–∫–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `mass_assignment_sanitizer` –≤ `config/environments/test.rb`:

```ruby
# Raise exception on mass assignment protection for Active Record models
config.active_record.mass_assignment_sanitizer = :strict
```

### vendor/plugins

–í Rails 3.2 —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç `vendor/plugins`, –∞ –≤ Rails 4.0 –±—É–¥–µ—Ç —É–±—Ä–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –•–æ—Ç—è —ç—Ç–æ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ –Ω–∞ Rails 3.2, –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –ª—é–±—ã–µ –ø–ª–∞–≥–∏–Ω—ã, –∏–∑–≤–ª–µ–∫–∞—è –∏—Ö –≤ –≥–µ–º—ã –∏ –ø–æ–º–µ—â–∞—è –∏—Ö –≤ `Gemfile`. –ï—Å–ª–∏ —Ä–µ—à–∞–µ—Ç–µ –Ω–µ –¥–µ–ª–∞—Ç—å –≥–µ–º—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏—Ö, —Å–∫–∞–∂–µ–º, –≤ `lib/my_plugin/*` –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –≤ `config/initializers/my_plugin.rb`.

### Active Record

–û–ø—Ü–∏—è `:dependent => :restrict` –±—ã–ª–∞ —É–±—Ä–∞–Ω–∞ –∏–∑ `belongs_to`. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞, –µ—Å–ª–∏ –∏–º–µ—é—Ç—Å—è –∫–∞–∫–∏–µ-–ª–∏–±–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `:dependent => :destroy` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `false` –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏ –∏–∑ –ª—é–±–æ–≥–æ –∫–æ–ª–±—ç–∫–∞ –Ω–∞ destroy —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

–ê–ø–≥—Ä–µ–π–¥ —Å Rails 3.0 –Ω–∞ Rails 3.1
--------------------------------

–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è Rails –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–µ–π—á–∞—Å —Å—Ç–∞—Ä—à–µ —á–µ–º 3.0.x, —Å–ª–µ–¥—É–µ—Ç —Å–ø–µ—Ä–≤–∞ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞–ø–≥—Ä–µ–π–¥ –Ω–∞ Rails 3.0, –ø–µ—Ä–µ–¥ –ø–æ–ø—ã—Ç–∫–æ–π –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –¥–æ Rails 3.1.

–°–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Rails 3.1.12, –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é 3.1.x Rails.

### Gemfile

–°–¥–µ–ª–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–≤–æ–µ–º `Gemfile`.

```ruby
gem "rails", "3.1.12"
gem "mysql2"

# Needed for the new asset pipeline
group :assets do
  gem "sass-rails",   "~> 3.1.7"
  gem "coffee-rails", "~> 3.1.1"
  gem "uglifier",     ">= 1.0.3"
end

# jQuery is the default JavaScript library in Rails 3.1
gem "jquery-rails"
```

### config/application.rb

–ö–æ–Ω–≤–µ–π–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤ (asset pipeline) —Ç—Ä–µ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–π:

```ruby
config.assets.enabled = true
config.assets.version = "1.0"
```

–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç "/assets" –¥–ª—è —Ä–µ—Å—É—Ä—Å–∞, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –∞—Å—Å–µ—Ç–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:

```ruby
# Defaults to '/assets'
config.assets.prefix = '/asset-files'
```

### config/environments/development.rb

–£–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–ª—è RJS `config.action_view.debug_rjs = true`.

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –µ—Å–ª–∏ –≤—ã –≤–∫–ª—é—á–∏–ª–∏ –∫–æ–Ω–≤–µ–π–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤:

```ruby
# Do not compress assets
config.assets.compress = false

# Expands the lines which load the assets
config.assets.debug = true
```

### config/environments/production.rb

–°–Ω–æ–≤–∞, –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–æ–Ω–≤–µ–π–µ—Ä—É —Ä–µ—Å—É—Ä—Å–æ–≤. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –Ω–∏—Ö –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ [Asset Pipeline](/asset-pipeline).

```ruby
# Compress JavaScripts and CSS
config.assets.compress = true

# Don't fallback to assets pipeline if a precompiled asset is missed
config.assets.compile = false

# Generate digests for assets URLs
config.assets.digest = true

# Defaults to Rails.root.join("public/assets")
# config.assets.manifest = YOUR_PATH

# Precompile additional assets (application.js, application.css, and all non-JS/CSS are already added)
# config.assets.precompile += %w( admin.js admin.css )

# Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.
# config.force_ssl = true
```

### config/environments/test.rb

–ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤, –¥–æ–±–∞–≤–∏–≤ —Å–ª–µ–¥—É—é—â–µ–µ –≤ —Å—Ä–µ–¥–µ test:

```ruby
# Configure static asset server for tests with Cache-Control for performance
config.public_file_server.enabled = true
config.public_file_server.headers = {
  'Cache-Control' => 'public, max-age=3600'
}
```

### config/initializers/wrap_parameters.rb

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–π —Ö—ç—à. –î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```ruby
# Be sure to restart your server when you modify this file.
# This file contains settings for ActionController::ParamsWrapper which
# is enabled by default.

# Enable parameter wrapping for JSON. You can disable this by setting :format to an empty array.
ActiveSupport.on_load(:action_controller) do
  wrap_parameters format: [:json]
end

# Disable root element in JSON by default.
ActiveSupport.on_load(:active_record) do
  self.include_root_in_json = false
end
```

### config/initializers/session_store.rb

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å –∫–ª—é—á —Å–µ—Å—Å–∏–∏ –Ω–∞ –¥—Ä—É–≥–æ–π, –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏:

```ruby
# in config/initializers/session_store.rb
AppName::Application.config.session_store :cookie_store, key: 'SOMETHINGNEW'
```

–∏–ª–∏

```bash
$ bin/rake db:sessions:clear
```

### –£–±—Ä–∞—Ç—å –æ–ø—Ü–∏–∏ :cache –∏ :concat –≤ —Ö–µ–ª–ø–µ—Ä–∞—Ö –∞—Å—Å–µ—Ç–æ–≤ –≤–æ –≤—å—é

* –í–º–µ—Å—Ç–µ —Å –∫–æ–Ω–≤–µ–π–µ—Ä–æ–º —Ä–µ—Å—É—Ä—Å–æ–≤ –æ–ø—Ü–∏–∏ :cache –∏ :concat –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —É–¥–∞–ª–∏—Ç–µ —ç—Ç–∏ –æ–ø—Ü–∏–∏ –∏–∑ –≤—å—é.
