h1. Интранет и безопасность администратора

Интранет и административные интерфейсы являются популярной целью для атак, поскольку они предоставляют привилегированный доступ. Хотя это и может потребовать несколько дополнительных мер безопасности, таковы реалии современного мира.

В 2007 году зарегистрирован первый специально изготовленный троян, похищающий информацию из Интранета, названный "Monster for employers" по имени вебсайта Monster.com, онлайн приложения по найму работников. Специально изготовленные трояны очень редки, поэтому риск достаточно низок, но, конечно, возможен, и пример показывает, что безопасность хоста клиента тоже важна. Однако, наибольшей угрозой для Интранета и администраторских приложений являются XSS и CSRF.

*XSS* Если ваше приложение повторно отображает введенные пользователем вредоносные данные, приложение уязвимо к XSS. Имена пользователей, комментарии, отчеты о спаме, адреса заказов это всего лишь обычные примеры, где может быть XSS.

Если есть всего лишь одно место в админке или Интранете, где ввод не был обработан, это делает целое приложение уязвимым. Возможными результатами могут быть похищение привилегированных администраторских куки, встраивание iframe для похищения администраторского пароля или установка злонамеренного программного обеспечения через дыры в безопасности браузера для установления контроля над компьютером администратора.

Обратитесь к разделу про инъекции для контрмер против XSS. Также _(highlight)Рекомендуется использовать плагин SafeErb_ в Интранете или администраторском интерфейсе.

*CSRF* Подделка межсайтовых запросов (CSRF) это гигантский метод атаки, он позволяет злоумышленнику делать все то, что может делать администратор или пользователь Интранета. Так как мы уже раньше рассматривали, как работает CSRF, вот несколько примеров того, как злоумышленники могут обращаться с Интранетом или административным интерфейсом.

Реальным примером является "перенастройка роутера с помощью CSRF":http://www.h-online.com/security/Symantec-reports-first-active-attack-on-a-DSL-router--/news/102352. Злоумышленники разослали зловредные электронные письма с вложенным CSRF мексиканским пользователям. Письма утверждали, что их ждет пластиковая карточка, но они также содержали тег изображения, который приводил к запросу HTTP-GET на перенастройку роутера пользователя (наиболее популярной модели в Мексике). Запрос изменял настройки DNS таким образом, что запросы к мексиканскому банковскому сайту направлялись на сайт злоумышленников. Все, кто обращался к банковскому сайту через роутер, видели фальшивый сайт злоумышленников, и у них были похищены регистрационные данные.

Другой пример изменял адрес почты и пароль Google Adsense. Если жертва входила в Google Adsense, административный интерфейс рекламных компаний Google, злоумышленник изменял ее полномочия.

Другой популярной атакой является спам от вашего веб приложения, вашего блога или форума для распространения зловредного XSS. Конечно, злоумышленник должен знать структуру URL, но большинство URL Rails достаточно просты или они могут быть легко найдены, если это административный интерфейс приложения с открытым кодом. Злоумышленник даже может сделать 1,000 попыток, просто включив злонамеренный тег IMG, который пытается использовать каждую возможную комбинацию.

По _(highlight)контрмерам против CSRF в административных интерфейсах и приложениях Интранет, обратитесь к разделу по CSRF_.

h4. Дополнительные меры предосторожности

Обычный административный интерфейс работает подобно этому: расположен в www.example.com/admin, может быть доступным только настроен признак администратора в модели  User, переотображает данные, введенные пользователем, и позволяет админу удалять/добавлять/редавтировать любую желаемую информацию. Вот некоторые мысли обо всем этом:

* Очень важно _(highlight)думать о худшем случае_: Что если кто-то в самом деле достанет мои куки или полномочия пользователя. Вы должны _(highlight)ввести роли_ для административного интерфейса, чтобы ограничить возможности злоумышленника. Или как насчет _(highlight)специальных полномочий авторизации_ для административного интерфеса, отличающихся от тех, которые используются в публичной части приложения. Или _(highlight)специального пароля для очень серьезных действий_?
* Действительно ли админ должен иметь доступ к интерфейсу из любой точки мира? Подумайте насчет _(highlight)ограничения авторизации рядом IP адресов_. Проверьте request.remote_ip для того, чтобы узнать об IP адресах пользователя. Это не абсолютная, но серьезная защита. Хотя помните, что могут использоваться прокси.
* _(highlight)Поместите административный интерфейс в специальный поддомен_, такой как admin.application.com, и сделайте его отдельным приложением со своим собственным управлением пользователями. Это сделает похищение админского куки из обычного домена www.application.com невозможным. Это происходит благодаря правилу ограничения домена вашего браузера: встроенный (XSS) скрипт на www.application.com не сможет прочитать куки для admin.application.com и наоборот.
